<TITLE>HEPDB -- H2hdbappen-Merging-databases-or-database-records </TITLE>
<P>
<H2><A NAME=H2hdbappen-Merging-databases-or-database-records.html>Merging databases or database records</A></H2>
<P>
The problem of merging records into the main database in a coherent manner
is not a trivial one. In particular, care must be taken that conflicting
updates are not entered into the main database. The routine <A HREF=H2hdbappen-Merging-databases-or-database-records.html#HDBMERG NAME=HDBMERG331> HDBMERG</A>
described below performs checks to ensure that at record to be merged into
the database does not conflict with any updates already in the database
that have been made since information upon which the new record is based
was extracted from the main database.
<P>
Routine <A HREF=H2hdbappen-Merging-databases-or-database-records.html#HDBMERG NAME=HDBMERG332> HDBMERG</A> will merge a database or records from a database with a
pre-existing `target' database. Depending on the options selected, all
subdetector subdirectories or only a selected few may have their records
merged. The subdetector-subdirectories to be merged are either specified
by a full pathname in <TT>CHAUX</TT>, or else a path to the relevant
subdetector-directory in <TT>CHAUX</TT> and a list of the selected
subdetector-subdirectory names in the <TT>NSDIR</TT> elements of the
<TT>CHARACTER</TT> vector <A NAME=CHSDIR333> CHSDIR</A>. The ``target'' database is identified by
the top-directory name given in <TT>CHTMAI</TT> .
<P>
The database which contains the records to be merged can be created with
the <A NAME=HDBNEW335> HDBNEW</A>. If the database has been
created with the <A HREF=H1hdbappen-Extraction-and-Merging-of-database-records.html#HDBEXTR NAME=HDBEXTR336> HDBEXTR</A> routine only the records which have been stored
in this database after calling <A HREF=H1hdbappen-Extraction-and-Merging-of-database-records.html#HDBEXTR NAME=HDBEXTR337> HDBEXTR</A> will be merged in. In the other
case all records will be merged in. If the option <A NAME=X338> X</A> is specified the
merged records are also written to an FZ file, but note that the
appropriated FZ calls should have previously been issued before calling
<A HREF=H2hdbappen-Merging-databases-or-database-records.html#HDBMERG NAME=HDBMERG339> HDBMERG</A>. By default a brief summary of all merged records is printed. This
can be suppressed with option <A NAME=N340> N</A>. For expert use only there is the facility
to change the range of applicability of the records on merging (option <A NAME=R341> R</A>).
<P>
<PRE>
        +--------------------------------------------------------+
        |CALL <A NAME=HDBMERG> HDBMERG</A> (PATHI,PATHO,KEYS,CHSDIR,NSECD,CHOPT,IRC*) |
        +--------------------------------------------------------+
                                  </PRE>
<P>
<DL>
<DT><TT>PATHI</TT></DT><DD>Full pathname of directory to be MERGacted.
<DT><TT>PATHO</TT></DT><DD>Name of top directory of the output database.
This database should not yet contain any of the subdirectories that are to
be copied from the main database, unless option <A NAME=O342> O</A> is requested.
<DT><TT>KEYS</TT></DT><DD>Vector specifying the required validity range.
<DT><TT>CHDIR</TT></DT><DD>Character array of subdirectories to be
MERGacted
<DT><TT>NSDIR</TT></DT><DD>Number elements in array <A NAME=CHDIR343> CHDIR</A>
<DT><TT>CHOPT</TT></DT><DD>Character variable containing a string of
single letter options
<DL>
<DT><TT>' '</TT></DT><DD>directory specified by <A NAME=PATHI344> PATHI</A> will be MERGacted
<DT><TT>'A'</TT></DT><DD>All subdirectories of the specified path will be
MERGacted
<DT><TT>'C'</TT></DT><DD>MERGact only records with key status bit copy set
<DT><TT>'I'</TT></DT><DD>extend the validity range beyond one experiment
number
<DT><TT>'M'</TT></DT><DD>no merge information will be stored
<DT><TT>'N'</TT></DT><DD>no summary will be printed
<DT><TT>'S'</TT></DT><DD>a selected subset of subdetector subdirectories
(specified in <A NAME=CHSDIR345> CHSDIR</A>) will be MERGacted
<DT><TT>'O'</TT></DT><DD>subdetector-subdirectories in <A NAME=PATHO346> PATHO</A> may exist
<DT><TT>'R'</TT></DT><DD>the new period of validity given by the integer
vector <A NAME=KEYS347> KEYS</A> is used. This may only be used for database records created by
the <A NAME=W349> W</A> not requested.
<DT><TT>X</TT></DT><DD>write extracted records also to an FZ file, where
the FZ logical unit number is given by the logical unit number for
<TT>PATHO+10</TT>.
</DL>
<DT><TT>IRC</TT></DT><DD>Return status
<DL>
<DT><TT>0</TT></DT><DD>Normal completion
</DL>
</DL>
<P>
