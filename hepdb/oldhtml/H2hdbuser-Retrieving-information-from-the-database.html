<TITLE>HEPDB -- H2hdbuser-Retrieving-information-from-the-database </TITLE>
<P>
<H2><A NAME=H2hdbuser-Retrieving-information-from-the-database.html>Retrieving information from the database</A></H2>
<P>
<H3>Retrieving ZEBRA datastructures</H3>
<P>
<PRE>
               +------------------------------------------+
               | CALL <A NAME=CDUSE> CDUSE</A> (PATH,*LSUP*,ISEL,CHOPT,IRC*) |
               +------------------------------------------+
                                  </PRE>
<P>
<DL>
<DT><TT>PATH</TT></DT><DD>Character string describing the pathname
<DT><TT>LSUP</TT></DT><DD>Address of the supporting link of the Keys
bank(s) <TT>KYDB</TT> (input or output)
<DT><TT>ISEL</TT></DT><DD>Integer vector specifying the instant of
validity for which a database object is required. The length of the vector
is equal to the number of validity range pairs, itself a database
constant. For example, in the case when we select by run and event, the
number of pairs is 2. ISEL then contains the specific run and event for
which an object is required.
<DT><TT>CHOPT</TT></DT><DD>Character string with any of the following
characters
<DL>
<DT><TT>A</TT></DT><DD>Accept existing datastructure if one already exists
in memory.
<DT><TT>D</TT></DT><DD>Drop datastructure at <A NAME=LSUP215> LSUP</A> before retrieving new
datastructure
<DT><TT>N</TT></DT><DD>Force retrieval of new datastructure even if
current information as still valid
<DT><TT>K</TT></DT><DD>read only the keys (no data is required)
</DL>
<DT><TT>IRC</TT></DT><DD>Integer return code
<DL>
<DT><TT> 0</TT></DT><DD> Successful operation
<DT><TT> 1</TT></DT><DD>Illegal character option
<DT><TT> 2</TT></DT><DD>Illegal path name
<DT><TT> 3</TT></DT><DD>Database structure in memory clobbered
<DT><TT> 4</TT></DT><DD>Illegal key option
<DT><TT> 5</TT></DT><DD>Error in <TT>DBCHLD</TT> in <TT>P3</TT>
communication
<DT><TT>36</TT></DT><DD>Data bank address zero on return from
<TT>DBKXIN</TT>
<DT><TT>37</TT></DT><DD>Insufficient space in <TT>USER</TT> store array
</DL>
</DL>
<P>
Prepares the database data structure in memory for any required Pathname
and set of Keys, unless already done. Returns (optionally) the addresses
in memory for the corresponding Key banks and Data banks after checking
their validity for the given time and keys.
<P>
If the pathname begins with a % character then it is assumed to be an
alias and is automatically translated by the internal HEPDB routines.
<P>
<H4>Supplementary return information</H4>
<P>
<DL>
<DT><TT>IQUEST(2)</TT></DT><DD>Return status (if <TT>IRC = 0</TT>)
<DL>
<DT><TT>0</TT></DT><DD>No disk I/O has been performed
<DT><TT>1</TT></DT><DD>Data have been refreshed from the disk
</DL>
</DL>
<P>
<H3>Retrieving multiple ZEBRA datastructures</H3>
<P>
<PRE>
          +----------------------------------------------------+
          |CALL <A NAME=CDUSEM> CDUSEM</A> (PATH,LSUP*,ISEL,IMASK,KEYS,CHOPT,IRC*) |
          +----------------------------------------------------+
                                  </PRE>
<P>
<DL>
<DT><TT>PATH</TT></DT><DD>Character string describing the pathname
<DT><TT>LSUP</TT></DT><DD>Address of the supporting link of the Keys
bank(s) <TT>KYDB</TT>
<DT><TT>ISEL</TT></DT><DD>Integer vector specifying the instant of
validity for which a database object is required. The length of the vector
is equal to the number of validity range pairs, itself a database
constant. For example, in the case when we select by run and event, the
number of pairs is 2. ISEL then contains the specific run and event for
which an object is required.
<DT><TT>IMASK</TT></DT><DD>Integer vector indicating which elements of
<A NAME=IMASK217> IMASK</A> is non-zero,
then the corresponding element of <A NAME=KEYS218> KEYS</A> is used in selecting a dataset.
<DT><TT>KEYS</TT></DT><DD>Vector of keys. Only the elements for which the
corresponding element of <A NAME=IMASK219> IMASK</A> is non-zero are assumed to contain useful
information.
<DT><TT>CHOPT</TT></DT><DD>Character string with any of the following
characters
<DL>
<DT><TT>'A'</TT></DT><DD>Accept existing datastructure if one already
exists in memory.
<DT><TT>'K'</TT></DT><DD>read only the keys (no data is required)
<DT><TT>'D'</TT></DT><DD>Drop datastructure at <A NAME=LSUP220> LSUP</A> before retrieving new
datastructure
<DT><TT>'N'</TT></DT><DD>Force retrieval of new datastructure even if
current information is still valid
<DT><TT>'M'</TT></DT><DD>Perform multiple selection: select according to
input keys banks, rather than <A NAME=KEYS221> KEYS</A> vector. The user must prepare a linear
chain of key banks prior to calling this routine using the routine <A HREF=H2hdbuser-Utility-routines.html#CDBOOK NAME=CDBOOK222> CDBOOK</A>.
<DT><TT>'S'</TT></DT><DD>Select all objects satisfying the input selection
criteria
</DL>
<DT><TT>IRC</TT></DT><DD>Integer return code
<DL>
<DT><TT> 0</TT></DT><DD> Successful operation
<DT><TT> 1</TT></DT><DD>Illegal character option
<DT><TT> 2</TT></DT><DD>Illegal path name
<DT><TT> 3</TT></DT><DD>Database structure in memory clobbered
<DT><TT> 4</TT></DT><DD>Illegal key option
<DT><TT> 5</TT></DT><DD>Error in <TT>DBCHLD</TT> in <TT>P3</TT>
communication
<DT><TT>36</TT></DT><DD>Data bank address zero on return from
<TT>DBKXIN</TT>
<DT><TT>37</TT></DT><DD>Insufficient space in <TT>USER</TT> store array
</DL>
</DL>
<P>
Prepares the database data structure in memory for any required Pathname
and set of Keys, unless already done. Returns (optionally) the addresses
in memory for the corresponding Key banks and Data banks after checking
their validity for the given time and keys.
<P>
If the pathname begins with a % character then it is assumed to be an
alias and is automatically translated by the internal HEPDB routines.
<P>
<H4>Supplementary return information</H4>
<P>
<DL>
<DT><TT>IQUEST(2)</TT></DT><DD>Return status (if <TT>IRC = 0</TT>)
<DL>
<DT><TT>0</TT></DT><DD>No disk i/o has been performed
<DT><TT>1</TT></DT><DD>Data have been refreshed from the disk
</DL>
</DL>
<P>
<H3>Retrieving data structure to user specified address</H3>
<P>
<PRE>
       +----------------------------------------------------------+
       | CALL <A NAME=CDGET> CDGET</A> (PATH,IXDIV,LSUP*,JBIAS,ISEL,KEYS,CHOPT,IRC*) |
       +----------------------------------------------------------+
                                  </PRE>
<P>
<DL>
<DT><TT>PATH</TT></DT><DD>Character string describing the pathname
<DT><TT>IXDIV</TT></DT><DD>Index of the division in which the data
structure should be returned
<DT><TT>LSUP</TT></DT><DD>Address of the data bank
<DT><TT>JBIAS</TT></DT><DD><A NAME=JBIAS224> JBIAS</A> together specify the address at
which the structure is to be inserted. If <TT>JBIAS < 1</TT> it is used as
an offset to the value of <A NAME=LSUP225> LSUP</A>, so the structure will be connected at
<TT>LQ(LSUP+JBIAS</TT>). If <TT>JBIAS = 1</TT> the data-structure will be
a top level data-structure connected at <A NAME=LSUP226> LSUP</A>. If <TT>JBIAS = 2</TT> the
data-structure will be created as a standalone structure
<DT><TT>ISEL</TT></DT><DD>Integer vector specifying the instant of
validity for which a database object is required. The length of the vector
is equal to the number of validity range pairs, itself a database
constant. For example, in the case when we select on run and event, the
number of pairs is 2. ISEL then contains the specific run and event for
which an object is required.
<DT><TT>KEYS</TT></DT><DD>Integer vector in which the keys vector
associated with the retrieved data object are returned.
<DT><TT>CHOPT</TT></DT><DD>Character string with any of the following
characters
<DL>
<DT><TT>'A'</TT></DT><DD>Accept existing datastructure if one already
exists in memory.
<DT><TT>'K'</TT></DT><DD>read only the keys (no data is required)
<DT><TT>'D'</TT></DT><DD>Drop datastructure at <A NAME=LSUP227> LSUP</A> before retrieving new
datastructure
<DT><TT>'N'</TT></DT><DD>Force retrieval of new datastructure even if
current information is still valid
</DL>
<DT><TT>IRC</TT></DT><DD>Integer return code
<DL>
<DT><TT> 0</TT></DT><DD> Successful operation
<DT><TT> 1</TT></DT><DD>Illegal character option
<DT><TT> 2</TT></DT><DD>Illegal path name
<DT><TT> 3</TT></DT><DD>Database structure in memory clobbered
<DT><TT> 4</TT></DT><DD>Illegal key option
<DT><TT> 5</TT></DT><DD>Error in <TT>DBCHLD</TT> in <TT>P3</TT>
communication
<DT><TT>36</TT></DT><DD>Data bank address zero on return from
<TT>DBKXIN</TT>
<DT><TT>37</TT></DT><DD>Insufficient space in <TT>USER</TT> store array
</DL>
</DL>
<P>
In some cases, for example in existing applications, one may wish to
retrieve a data structure to a user specified location. In this case,
<A HREF=H2hdbuser-Retrieving-information-from-the-database.html#CDGET NAME=CDGET228> CDGET</A> may be used. Note that the data caching provided by <A HREF=H2hdbuser-Retrieving-information-from-the-database.html#CDUSE NAME=CDUSE229> CDUSE</A> and <A HREF=H2hdbuser-Freeing-information-from-memory.html#CDFREE NAME=CDFREE230> CDFREE</A>
is not supported by this routine.
<P>
If the pathname begins with a % character then it is assumed to be an
alias and is automatically translated by the internal HEPDB routines.
<P>
<H4>Supplementary return information</H4>
<P>
<DL>
<DT><TT>IQUEST(2)</TT></DT><DD>Return status (if <TT>IRC = 0</TT>)
<DL>
<DT><TT>0</TT></DT><DD>No disk i/o has been performed
<DT><TT>1</TT></DT><DD>Data have been refreshed from the disk
</DL>
</DL>
<P>
