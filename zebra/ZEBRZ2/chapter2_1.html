<HEAD>
<TITLE>  Description of user callable RZ routines</TITLE>
</HEAD>
<BODY><P>
 <HR> <A NAME=tex2html86 HREF=tex2htmlindex2_2.html><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/next_motif.gif"></A> <A NAME=tex2html84 HREF=ZEBRZ2.html><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/up_motif.gif"></A> <A NAME=tex2html78 HREF=ZEBRZ2.html><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/previous_motif.gif"></A>  <A NAME=tex2html88 HREF=tex2htmlindex2_2.html><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/index_motif.gif"></A><BR>
<B> Next:</B> <A NAME=tex2html87 HREF=tex2htmlindex2_2.html>Index</A>
<B>Up:</B> <A NAME=tex2html85 HREF=ZEBRZ2.html>No Title</A>
<B> Previous:</B> <A NAME=tex2html79 HREF=ZEBRZ2.html>No Title</A>
<HR> <P>
<H1><A NAME=SECTION0010000000000000000> Description of user callable RZ routines</A></H1>
<P>
<H1><A NAME=SECTION0010000000000000000>  Description of user callable RZ routines</A></H1>
4cmOpen a direct access file
<P><A NAME=RZOPEN>CALL RZOPEN (*LUN*,CHDIR*,CHNAME,CHOPT,*LRECL*,ISTAT*)</A><P>
<P>
<DL COMPACT>
<DT>LUN
<DD>Logical unit number associated with the RZ file.
The <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOPEN>RZOPEN</A> routine issues a FORTRAN OPEN statement for the
specified logical unit, unless option C is specified.
Option <tt>C</tt> selects C I/O using the KERNLIB <tt>CFIO</tt> routines.
<A NAME=58><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=59><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
If this option is selected, <tt>LUN</tt> returns the file pointer
from the C library I/O routines.
<DT>CHDIR
<DD>Character variable in which the top directory
name is returned (option <tt>W</tt>). The name has the form
``<tt>LUNn</tt>'', e.g. ``<tt>LUN1</tt>'' or ``<tt>LUN99</tt>'',
if FORTRAN I/O is used, or 
``<tt>LUN1003</tt>'' or ``<tt>LUN11021</tt>'' in the case of C I/O.
<DT>CHNAME
<DD>Character variable specifying the name of the 
file to be opened.
<DT>CHOPT
<DD>Character variable specifying the options required.
<DL COMPACT>
<DT>' '
<DD>  default, open file in readonly mode
<DT>'L'
<DD>  create file with relative organization (VAX only)
<DT>'N'
<DD>  open a new file
<DT>'S'
<DD>  open file in shared readonly mode
<DT>'U'
<DD>  open file in update mode
<DT>'SU'
<DD> open file in shared update mode
<DT>'1'
<DD>  open file read/write assume single user
<DT>'W'
<DD>  return in <tt>CHDIR</tt> directory name include
<DT>'Y'
<DD>  suppress <tt>LRECL</tt> consistency check
<DT>'C'
<DD>  Use C I/O instead of FORTRAN I/O
<DT>'X'
<DD>  Exchange mode file
<DT>'P'
<DD>  Preserve case of file name (Unix systems)
</DL><DT>LRECL
<DD> Integer variable specifying the record length
of the file in machine words.
If a value of zero (0) is specified, the <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOPEN>RZOPEN</A> routine 
will attempt to obtain the correct record length from
the file itself. A value of zero must not be specified for new files.
<DT>ISTAT
<DD> Integer variable in which the status code
is returned. 
</DL>The <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOPEN>RZOPEN</A> routine opens a new or existing RZ file
on the specified logical unit. A call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A>, for
existing files, or <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A>, for new files, must follow
a successful call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOPEN>RZOPEN</A>.
<P>
<H3><A NAME=SECTION0010010000000000000> RZOPEN status information returned in <tt>IQUEST</tt></A></H3>
<P>
<DL COMPACT>
<DT>IQUEST(10
<DD> Record length (machine words, 32-bit words for exchange mode).
<DT>IQUEST(11
<DD> C-file pointer (from <A HREF=../../zebra/ZEBFZ2/chapter2_1.html#CFOPEN>CFOPEN</A>).
<DT>IQUEST(12
<DD> Exchange mode flag (set if <tt>X</tt> is specified or is an existing
                 file is in exchange mode).
</DL><H3><A NAME=SECTION0010020000000000000> Operating system dependent features</A></H3>
<P>
On Unix systems, filenames are translated to lowercase
unless the <tt>P</tt> option is specified. 
Lowercase filenames
are recommended to avoid problems with mixed or uppercase
filenames which might occur, for example with NFS servers.
<A NAME=86><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A><A NAME=87><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
When accessing RZ files over DECnet, care should be taken
to ensure that the RMS network block count is sufficient
to process the remote file. The block count is specified
in 512 byte blocks.
<A NAME=88><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A><A NAME=89><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A><A NAME=90><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<b>Accessing a file with record length 4096 words over DECnet</b><PRE><TT>$ SET RMS/NETWORK_BLOCK_COUNT=32</TT></PRE>
<P>
On MVS systems, the prefix for the current userid
will be automatically prepended to the filename
unless the filename begins with a dot (``.'').
For instance, assuming <tt>R01jds</tt> is the current userid prefix,
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOPEN>RZOPEN</A> opens file <tt>R01JDS.RZTEST.DATA</tt> for both of the following 
file specifications:
<PRE><TT>CHFILE = 'RZTEST.DATA'
      CHFILE = '.R01JDS.RZTEST.DATA'</TT></PRE>
<A NAME=95><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<H3><A NAME=SECTION0010030000000000000> AFS and NFS specific considerations</A></H3>
<P>
C input/output is particularly interesting when accessing Unix
files from a VAX/VMS system via NFS. Such files cannot
be read by FORTRAN, but can be processed successfully
using C. If the file resides on a Unix system, such
as an Apollo, Sun etc. the option 'X' should also be
specified to indicate that the file is in exchange format
by default. Files created on Cray Unicos systems are not,
by default, in exchange format.
<A NAME=97><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<H1><A NAME=SECTION0011000000000000000> Create a new RZ file</A></H1>
<P>
<A NAME=100><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZMAKE>CALL RZMAKE (LUN,CHDIR,NWKEY,CHFORM,CHTAG,NREC,CHOPT)</A><P>
<P>
<DL COMPACT>
<DT>LUN
<DD>Logical unit number associated with the RZ file.
A FORTRAN <tt>OPEN</tt> statement or call to the
routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOPEN>RZOPEN</A> must precede the call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A>.<BR>Starting address of the memory area which will contain the
RZ information (<tt>'M'</tt> option)
<DT>CHDIR
<DD>Character variable specifying the name of the top directory to be
associated with unit <tt>LUN</tt> (up to 16 characters).
<DT>NWKEY
<DD> Number of words associated to a key <b>(maximum 100)</b>
<DT>CHFORM
<DD> Character variable describing each element of the key vector
<DL COMPACT>
<DT>'B'
<DD>Bit string but not zero
<DT>'H'
<DD>Hollerith (4 characters)
<DT>'A'
<DD>Same as <tt>'H'</tt> except for <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZLDIR>RZLDIR</A>
<DT>'I'
<DD>Integer (nonzero)
</DL><DT>CHTAG
<DD>Character array defined as <tt>CHARACTER*8 CHTAG(NWKEY)</tt>.<BR>Each element of the array allows the description of the corresponding
element in the key vector with a tag of up to 8 characters.
<DT>NREC
<DD>Number of physical records for the primary allocation
<DT>CHOPT
<DD>Character variable specifying the selected options.
<DL COMPACT>
<DT>medium
<DD>
<DL COMPACT>
<DT>' '
<DD>Disk (default)
<DT>'M'
<DD>Memory - The user must allocate at least <tt>NREC*LUN</tt> words
of memory starting at address <tt>LUN</tt> if this option is used
(see below).
</DL><DT>mode
<DD>
<DL COMPACT>
<DT>' '
<DD>Native mode (default)
<DT>'X'
<DD>Exchange mode (32 bit machines only)
</DL><DT>other
<DD>
<DL COMPACT>
<DT>'F'
<DD>Format <tt>NREC</tt> records, unless option <tt>'M'</tt>.
<DT>'C'
<DD>Use C I/O
</DL></DL></DL>Subroutine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A> creates a new RZ file on the specified
logical unit. Should the file already exist, the routine
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A> should be used.
On return from <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A>, <tt>IQUEST(1)</tt>
<A NAME=1087><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
will be set to 0
if the routine was successful. A non-zero value for
<tt>IQUEST(1)</tt> indicates an error.
<P>
The following example opens and creates a new RZ file,
whose top directory contains
three words per key, the first one being an integer (the year) and the
two others being Hollerith (the month and the day).
A total of 5000 records of length 4096 bytes are requested.
<P>
<b>Example of using the routine RZMAKE</b><PRE><TT>CHARACTER*16 CHDIR
      CHARACTER    CHTAG(3)*8
      DATA CHTAG/'Year','Month','Day'/
      LRECL = 1024
      CALL RZOPEN(LUN,CHDIR,'RZTEST.DAT','N',LRECL,ISTAT)
      IF(ISTAT.NE.0) GOTO 999
      CALL RZMAKE(LUN,'Top_Dir',3,'IHH',CHTAG,5000,' ')
 
  999 PRINT *,'Return code from RZOPEN = ',ISTAT</TT></PRE>
<P>
Option <tt>'F'</tt> is particularly important for RZ files on
<A NAME=146><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
VM/CMS systems, when shared access is required. Further
details are given in Appendix A.
<P>
<b>N.B. when using option C, the call to RZMAKE must 
immediately follow a call to RZOPEN. This permits the
record length of the file to be passed from RZOPEN to RZMAKE,
where it is stored in an RZ control bank for future use</b>.
<P>
Option <tt>'M'</tt> creates an RZ file in memory. The
variable <tt>LUN</tt> contains the record length.
The address of this variable is used as the starting
address for the memory file, as shown in the following example.
<b>Example of creating a memory file</b><PRE><TT>COMMON/MEMRZ/IBUFF(163840)
*
*     Set record length of memory file to 1024 words
*     Starting address is LOCF(IBUF(1))
*     Number of 'records' is 160 (length of IBUFF/lrecl)
*
      IBUF(1) = 1024
      CALL RZMAKE(IBUF(1),'MEMRZ',3,'IHH',CHTAG,160,'M')</TT></PRE>
<P>
<H1><A NAME=SECTION0011000000000000000>  Create a new RZ file</A></H1>
4cmAccess an existing RZ file
<P>
<A NAME=154><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZFILE>CALL RZFILE (LUN,CHDIR,CHOPT)</A><P>
<P>
<DL COMPACT>
<DT>LUN
<DD>Logical unit number associated with the RZ file.
A call to the routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOPEN>RZOPEN</A> or 
a FORTRAN <tt>OPEN</tt> statement must precede the call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A>.
<DT>CHDIR
<DD>Character variable specifying the name of the top directory to be
associated with unit <tt>LUN</tt>.
<DT>CHOPT
<DD>Character variable specifying the selected options.
<DL COMPACT>
<DT>medium
<DD>
<DL COMPACT>
<DT>' '
<DD>Disk (default)
</DL><DT>mode
<DD>
<DL COMPACT>
<DT>' '
<DD>Read mode (default)
<DT>'S'
<DD>Shared mode
<DT>'U'
<DD>Update mode
<DT>'1'
<DD>Update mode and only one user (no LOCKs necessary)
<DT>'L'
<DD>List current LOCK identifiers
<DT>'D'
<DD>Reset &quot;locking&quot; word of the file (after program crash !)
<DT>'C'
<DD>Use C I/O
<DT>'X'
<DD>Exchange format file
</DL></DL></DL><A NAME=173><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=174><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>Subroutine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A> accesses an existing RZ file on the specified
logical unit. Should the file not yet exist, the routine
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A> should be used.
<P>On return from <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A>, <tt>IQUEST(1)</tt>
<A NAME=1090><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
will be set to 0 if the routine was successful. 
A non-zero value for <tt>IQUEST(1)</tt>
indicates an error.
<P>
<b>N.B. when using option C, the call to RZFILE must 
immediately follow a call to RZOPEN. This permits the
record length of the file to be passed from RZOPEN to RZFILE,
where it is stored in an RZ control bank for future use</b>.
<P>
<P><A NAME=RZHOOK>CALL RZHOOK (LUN,CHDIR,TARGET,LRECL,CHOPT)</A><P>
<P>
<DL COMPACT>
<DT>LUN
<DD>Logical unit number associated with the RZ file.
The RZ file must already be open before calling <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZHOOK>RZHOOK</A>
<DT>CHDIR
<DD>Character variable specifying the name of the top directory to be
associated with unit <tt>LUN</tt>.
<DT>TARGET
<DD>Integer variable containing the address of the user
routine that is to be called to perform the I/O.
This routine must be declared <tt>EXTERNAL</tt> in the routine
that calls <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZHOOK>RZHOOK</A>.
<DT>LRECL
<DD>Integer variable containing the record length of the
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A> in words.
<DT>CHOPT
<DD>Character variable specifying the selected options, as for
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A>.
</DL>Subroutine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZHOOK>RZHOOK</A> accesses an existing RZ file which must
already be connected and ready for I/O. <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZHOOK>RZHOOK</A> calls
the routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A> which reads records from the RZ file.
<P>
The specifications for the user I/O routine are the same as for
<A HREF=../../zebra/ZEBFZ2/chapter2_1.html#FZHOOK>FZHOOK</A>.
<P>
<b>An example of a user coded I/O routine</b><PRE><TT>SUBROUTINE FMXZIO(IBUF,IOWAY)
      DIMENSION IBUF(8192)
+CDE,ZMACH.
+CDE,QUEST.
+CDE,FATBUG.
      CHARACTER*6  CHWAY

      IRC  = 0
      IF(IDEBFA.GE.3) PRINT *,'FMXZIO. IQUEST(1-6) = ',
     +   (IQUEST(J),J=1,6)
      LUN  = IQUEST(1)
      NREC = IQUEST(4)
      IF(IOWAY.EQ.0) THEN
         CALL XZREAD(LUN,IBUF,NREC,IQUEST(2)*IQCHAW,NGOT,' ',IRC)
      ELSEIF(IOWAY.EQ.1) THEN
         CALL XZRITE(LUN,IBUF,NREC,IQUEST(2)*IQCHAW,' ',IRC)
      ELSE
         WRITE(CHWAY,'(I6)') IOWAY
         CALL ZFATAM('Invalid value for IOWAY in FMXZIO - '//CHWAY)
      ENDIF

      IQUEST(1) = IRC

      END</TT></PRE>
<P>
<H1><A NAME=SECTION0011000000000000000>   Create a new RZ file</A></H1>
4cmSet the logging level
<P>
<P><A NAME=RZLOGL>CALL RZLOGL (LUN,LOGLEV)</A><P>
<A NAME=204><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=205><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<DL COMPACT>
<DT>LUN
<DD>Logical unit number for which the logging level has to be set
<DT>LOGLEV
<DD>Logging level
<DL COMPACT>
<DT>-3
<DD>Suppress all messages
<DT>-2
<DD>Error messages only
<DT>-1
<DD>Terse logging
<DT> 0
<DD>Normal logging: <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZEND>RZEND</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZCLOS>RZCLOS</A>
<DT> 1
<DD>Log to watch rare events
<DT> 2
<DD>Log to monitor calls
<DT> 3
<DD>Short dumps to debug user-written output routines
<DT> 4
<DD>Full dumps to debug user-written output routines
</DL></DL>The logging level
(i.e. the verboseness of the messages of the ZEBRA system) can be
controlled for a given RZ unit number by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZLOGL>RZLOGL</A>.
<P>
Each declaration of an RZ file via <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A> or <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A>
associates a default logging level of 0 to the file.
At any point in a program the logging level can be reset to a new
value by calling <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZLOGL>RZLOGL</A> with the appropriate parameters.
<P>
<H1><A NAME=SECTION0011000000000000000>    Create a new RZ file</A></H1>
4cmClose a direct access file
<P>
<A NAME=223><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZCLOS>CALL RZCLOS (CHDIR,CHOPT)</A><P>
<P>
<DL COMPACT>
<DT>CHDIR
<DD>Character variable specifying the name of the top directory of the
file to be closed.
<DT>CHOPT
<DD>Character variable specifying the options required.
<DL COMPACT>
<DT>' '
<DD>  default, close file specified by the variable <tt>CHDIR</tt>
<DT>'A'
<DD>  close all files - <tt>CHDIR</tt> not used
</DL></DL>This routine terminates RZ access to the file referenced
by the specified top directory <tt>CHDIR</tt>, and issues a FORTRAN
or C close for the associated file. For this reason,
it should be used in preference to the routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZEND>RZEND</A>.
<P>
<P><A NAME=RZEND>CALL RZEND (CHDIR)</A><P>
<A NAME=238><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<DL COMPACT>
<DT>CHDIR
<DD>Character variable specifying the name of the top directory of the
file to be closed.
</DL>A direct access file, identified by a top directory name,
is closed by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZEND>RZEND</A>.
The directories present in memory,
when they have been changed,
are copied to the file and then deleted from memory, else
the directories in memory are simply deleted.
Note that a FORTRAN close statment must be provided by the
user for the associated file.
<P>
<H1><A NAME=SECTION0011000000000000000>     Create a new RZ file</A></H1>
4cmSave modified directories
<A NAME=246><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZSAVE>CALL RZSAVE  </A><P>
<P>
All directories which have been modified in memory
and the current output buffer are written to the output file by a call
to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZSAVE>RZSAVE</A>. This routine is called
automatically by the system when using <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZCDIR>RZCDIR</A>, 
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZCLOS>RZCLOS</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZEND>RZEND</A> or <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFREE>RZFREE</A>.
In an interactive environment it may save to call <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZSAVE>RZSAVE</A> from
time to time.
<P>
<H1><A NAME=SECTION0011000000000000000>      Create a new RZ file</A></H1>
4cmOperations on RZ directories
<H2><A NAME=SECTION0011000000000000000>       Create a new RZ file</A></H2>
4cmDefine the naming directory
<A NAME=260><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZNDIR>CALL RZNDIR (*CHPATH*,CHOPT)</A><P>
<P><B>Input parameter description:</B><P><DL COMPACT>
<DT>*CHPATH*
<DD>Character variable specifying the complete pathname of the
naming directory (<tt>'S'</tt> option)
<DT>CHOPT
<DD>Character variable specifying the option
<DL COMPACT>
<DT>' '
<DD>Set the naming directory to the path specified in
<tt>CHPATH</tt> (default)
<DT>'P'
<DD>Print the naming directory
<DT>'R'
<DD>Read the naming directory pathname into <tt>CHPATH</tt>
</DL></DL><P><B>Output parameter description:</B><P><DL COMPACT>
<DT>*CHPATH*
<DD>Character variable containing the complete pathname of the
naming directory (<tt>'R'</tt> option).
</DL><P>When one is working with many different directories, and has to
refer frequently the same directory, then the latter can be defined
as the <b>naming directory</b>, designated by the symbol
'~'
in pathnames.
A typical example would be an application where subdirectories have
to be created in user routines in which the complete pathname of the
naming directory is unknown.
To set the naming directory a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZNDIR>RZNDIR</A> must be made.
<H3><A NAME=SECTION0011010000000000000> RZNDIR return codes</A></H3>
<P>
<DL COMPACT>
<DT>0
<DD>Normal completion
<DT>1
<DD><tt>'S'</tt> (default) option and the pathname <tt>CHPATH</tt> is invalid
</DL><H2><A NAME=SECTION0011010000000000000>  RZNDIR return codes</A></H2>
4cmDefine the current working directory
<A NAME=286><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=287><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZCDIR>CALL RZCDIR (*CHPATH*,CHOPT)</A><P>
<P><B>Input parameter description:</B><P><DL COMPACT>
<DT>*CHPATH*
<DD>Character variable specifying the pathname of the <tt>CWD</tt>
(default).<BR><tt>CHPATH = ' '</tt> means the <tt>CWD</tt> (useful with the <tt>'U'</tt> option)<BR>Unless several RZ files are open at the same time, the path name can
be specified either as a path starting with the character <tt>'/'</tt>, in
which case an absolute pathname is intended for the given top directory.
When several RZ files are open, an absolute pathname must start with a
double slash <tt>'//'</tt> and the top directory.
When the pathname does not start with a <tt>'/'</tt>, the pathname is prefixed
with the path of the <tt>CWD</tt>.
<DT>CHOPT
<DD>Character variable specifying the option
<DL COMPACT>
<DT>' '
<DD>Set the <tt>CWD</tt> (default)
<DT>'P'
<DD>Print the <tt>CWD</tt>
<DT>'R'
<DD>Read the <tt>CWD</tt> pathname into <tt>CHPATH</tt>
<DT>'U'
<DD>The same as the default but the time stamp in the
directory in memory is checked against the one on the file and if
needed the directory in memory is brought up to date.
This option should be used when the user expects that directories can be
changed concurrently by another user and he wants to use the latest
version.
<DT>'K'
<DD>Keep the Current Directory in memory. By default, space occupied
by the Current Directory may be released in case there is not enough
space to accomodate the new directory.
</DL></DL><P><B>Output parameter description:</B><P><DL COMPACT>
<DT>*CHPATH*
<DD>Character variable containing the complete pathname of the
<tt>CWD</tt> (<tt>'R'</tt> option)
</DL><P>The <tt>CWD</tt> is set to the top directory after a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A>.
The <tt>CWD</tt> can be changed, displayed or obtained by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZCDIR>RZCDIR</A>.
<P>All operations of RZ routines manipulating keys
(i.e. <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZIN>RZIN</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOUT>RZOUT</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZRDIR>RZRDIR</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZKEYS>RZKEYS</A>,
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZPURG>RZPURG</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZDELK>RZDELK</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZDELT>RZDELT</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZQUOT>RZQUOT</A>,
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZPASS>RZPASS</A>) refer to objects in
the ``Current Working Directory'' or <tt>CWD</tt> for short.
<P>
<H3><A NAME=SECTION0011020000000000000> RZCDIR return codes</A></H3>
<P>
<A NAME=1092><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<DL COMPACT>
<DT>IQUEST(1)
<DD>Error status
<DL COMPACT>
<DT>0
<DD>Normal completion
<DT>1
<DD>The pathname <tt>CHPATH</tt> is invalid (default option)
</DL><DT>IQUEST(7)
<DD><tt>NKEYS</tt>, number of keys in the directory
<DT>IQUEST(8)
<DD><tt>NWKEY</tt>, number of words in a key
<DT>IQUEST(9)
<DD>Number of directories below <tt>CWD</tt>.
<DT>IQUEST(10)
<DD><tt>NQUOTA</tt>, the record quota for the <tt>CWD</tt> tree.
</DL><H3><A NAME=SECTION0011030000000000000> Examples:</A></H3>
<P>
It is not necessary to specify <tt>//Top_dir</tt> in a pathname
unless several RZ files are open simultaneously.
If only one RZ file is declared, the following two calls
are equivalent:
<P>
<PRE><TT>CALL RZCDIR('//top_dir/dira/dirb/dirc',' ')
and
      CALL RZCDIR('/dira/dirb/dirc',' ')</TT></PRE>
<P>
If the <tt>CWD</tt> was already set to <tt>/dira/dirb</tt>
one can further abbreviate
the calling sequence to
<P>
<PRE><TT>CALL RZCDIR('dirc',' ')</TT></PRE>
<P>
To go one level up in the directory tree one can use '
<PRE>


n

</PRE>', e.g.
if the <tt>CWD</tt> is <tt>/dira/dirb/dirc</tt>
then the two following calls are equivalent:
<P>
<PRE><TT>CALL RZCDIR('\',' ')
and
      CALL RZCDIR('/dira/dirb',' ')</TT></PRE>
<P>
To set the <tt>CWD</tt> to the Naming directory one uses:
<P>
<PRE><TT>CALL RZCDIR('~',' ')</TT></PRE>
<P>
<H2><A NAME=SECTION0011030000000000000>  Examples:</A></H2>
4cmCreation of a directory
<A NAME=351><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZMDIR>CALL RZMDIR (CHDIR,NWKEY,CHFORM,CHTAG)</A><P>
<P>
<DL COMPACT>
<DT>CHDIR
<DD>Character variable with a maximum of 16 characters (for the given
level), specifying the name of the directory to be
created. All characters, but /, \ ,* ,~ or ?
are allowed in a directory name.
<DT>NWKEY
<DD>Number of words associated to a key <b>(maximum 100)</b>
<DT>CHFORM
<DD>Character variable describing each element of the key vector
(a blank is equivalent to <tt>'I'</tt>).
<DL COMPACT>
<DT>'B'
<DD> Bit string but not zero
<DT>'H'
<DD> Hollerith (4 characters)
<DT>'A'
<DD> same as <tt>'H'</tt> (see <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZLDIR>RZLDIR</A>)
<DT>'I'
<DD> Integer (nonzero)
</DL><DT>CHTAG
<DD> Character array defined as <tt>CHARACTER*8 CHTAG(NWKEY)</tt>.<BR>Each element of the array allows the description of the corresponding
element in the key vector with a tag of up to 8 characters.
</DL>A directory below the current ``working directory'' (see <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZCDIR>RZCDIR</A>)
can be created by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>.
<P>
<H3><A NAME=SECTION0011040000000000000> Example 1: Creating the geometry file of a LEP experiment</A></H3>
<P>
To create a geometry file for the OPAL detector
the data base for the experiment has as top directory called
<tt>//OPAL</tt>.
A directory called <tt>Geometry</tt> is created, which will contain
the names of the 12 main detectors of OPAL.
<P>
<PRE><TT>CHARACTER TAGS(2)*8
      INTEGER   KEY(2)
 
      CALL RZMDIR('Geometry',1,'H','Detector')
      CALL RZCDIR('Geometry',' ')
      TAGS(1)='Volume'
      TAGS(2)='Number'
      CALL RZMDIR('CDET',2,'HI',TAGS)
      CALL RZMDIR('ECAL',2,'HI',TAGS)
      CALL RZMDIR('HCAL',2,'HI',TAGS)
      CALL RZMDIR('FDET',2,'HI',TAGS)
      CALL RZMDIR('MUON',2,'HI',TAGS)
              .......</TT></PRE>
<P>
As we now want to introduce information into the <tt>CDET </tt> directory,
we put our working directory equal to the latter by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZCDIR>RZCDIR</A>:
<P>
<PRE><TT>CALL RZCDIR('CDET',' ')</TT></PRE>
<P>
which is equivalent to
<P>
<PRE><TT>CALL RZCDIR('//OPAL/Geometry/CDET'),' ')</TT></PRE>
<P>
<H3><A NAME=SECTION0011050000000000000> Example 2: Using the geometry file of a LEP experiment</A></H3>
<P>
Logical records can then be entered corresponding to the parameters
of each of the 24 sectors of the Jet chamber of the Central detector,
of the vertex detector and of the Z chambers
(routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOUT>RZOUT</A> is described below).
<P>
<PRE><TT>C--     Write the information for the 24 Jet chamber sectors
      CALL UCTOH('SECT',KEY,4,4)
      DO 10 ISECT=1,24
          KEY(2)=ISECT
          CALL RZOUT(IXSTOR,LQ(LCDET-ISECT),KEY,ICYCLE,' ')
   10 CONTINUE
C--     Write the information for the vertex chamber
      CALL UCTOH('VERT',KEY,4,4)
      KEY(2)=1
      CALL RZOUT(IXSTOR,LVERT,KEY,ICYCLE,' ')
C--     Write the information for the Z chambers
      CALL UCTOH('ZCHA',KEY,4,4)
      CALL RZOUT(IXSTOR,LZCHA,KEY,ICYCLE,' ')</TT></PRE>
<P>
Update records for the geometry of each detector can be foreseen, e.g.
by creating a directory <tt>'Updates'</tt> below <tt>'CDET'</tt>
<P>
<PRE><TT>CALL RZMDIR('Updates',1,'I','RUN')</TT></PRE>
<P>
The Logical records in the <tt>'Updates'</tt> directory will contain the
detector's identification as well as update parameters. <tt>KEY(1)</tt> could be
the <tt>RUN</tt> number from which the given corrections should be applied.
The procedure to build the geometry data structure could be the following:
<P>
<P>
<PRE>


 -- Read the standard parameters in directory 'CDET'

 -- Set the CWD to 'Updates' and check if there are corrections to be
    applied for that run,etc.
</PRE><P><H2><A NAME=SECTION0011050000000000000>  Example 2: Using the geometry file of a LEP experiment</A></H2>
4cmGet the key definitions for the current working directory
<P>
<A NAME=385><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZKEYD>CALL RZKEYD (NWKEY*,CHFORM*,CHTAG*)</A><P>
<P><B>Output parameter description:</B><P><DL COMPACT>
<DT>NWKEY*
<DD>Number of words associated to a key in the <tt>CWD</tt>
<DT>CHFORM*
<DD>Character variable describing each element of the key vector
(see <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>)
<DT>CHTAG*
<DD>Character array defined as <tt>CHARACTER*8 CHTAG(NWKEY)</tt>.<BR>Each element of the array describes the corresponding
element in the key vector.
</DL>Information about the key definitions, as declared by <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>,
for the <tt>CWD</tt> can be obtained be a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZKEYD>RZKEYD</A>.
<P>
<H2><A NAME=SECTION0011050000000000000>   Example 2: Using the geometry file of a LEP experiment</A></H2>
4cmLock and unlock a directory
<A NAME=399><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=400><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZLOCK>CALL RZLOCK (CHLOCK)</A><P>
<DL COMPACT>
<DT>CHLOCK
<DD>Character variable (up to 8 characters) identifying the owner
of the lock (e.g.
specifying the name of the user, his computer identifier,...).
This parameter is used to avoid two users, who have both the
write password for a directory, trying to change it at the same time.
<tt>CHLOCK</tt> is also useful in the case of a system crash while a directory
was locked.
</DL>When an RZ random access file is declared mode <tt>'SU'</tt> (shared/update)
with <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFILE>RZFILE</A> , then care must be taken to propagate the changes made
to the file to other processes, which are accessing the file
concurrently. Therefore, whenever the
directory structure or the data part of the <tt>CWD</tt> has to be changed by
calling one of the following routines:
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZCOPY>RZCOPY</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZDELT>RZDELT</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZDELK>RZDELK</A>,
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFRFZ>RZFRFZ</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOUT>RZOUT</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZPURG>RZPURG</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZQUOT>RZQUOT</A>, <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZRENK>RZRENK</A>,
<A NAME=419><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=420><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
then, before using the first time any of these routines,
the <tt>CWD</tt> must be locked by a calling routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZLOCK>RZLOCK</A>.
To use this routine the write
password must have been specified if one has been defined.
Once a directory is locked, all
subdirectories become unavailable for locking. Hence when the top
directory is locked, the complete file is locked.
<P>
Note that two or more branches of a directory can be modified
concurrently
by different users (each one making a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZLOCK>RZLOCK</A>), as long as
for any given directory to be locked there is no higher level
directory already in a locked state.
<P>
<P><A NAME=RZFREE>CALL RZFREE (CHLOCK)</A><P>
<DL COMPACT>
<DT>CHLOCK
<DD>Character variable identifying the owner of the lock.
</DL>Once all modifications to a directory are performed, it must
be unlocked by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFREE>RZFREE</A>. This routine outputs the updated
directories and provides them with a time stamp, so that other users
can determine whether they want to update the copy of the directories
they are working with.
<P>
<H2><A NAME=SECTION0011050000000000000>    Example 2: Using the geometry file of a LEP experiment</A></H2>
4cmSet the space quota for the current working directory
<A NAME=432><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZQUOT>CALL RZQUOT (NQUOTA)</A><P>
<P><B>Input parameter description:</B><P><DL COMPACT>
<DT>NQUOTA
<DD>The maximum number of records which can be used by the <tt>CWD</tt>
and its subdirectories<BR>By default <tt>NQUOTA</tt> is equal to the minimum of the total number of
records allowed for the complete file (parameter <tt>NREC</tt>
in <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A>) and the quota of the parent directory.
</DL>Routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZQUOT>RZQUOT</A> allows the user to define a
space quota for the <tt>CWD</tt> and all its subdirectories.
<P>
<H2><A NAME=SECTION0011050000000000000>     Example 2: Using the geometry file of a LEP experiment</A></H2>
9cmScan RZ directory structure
<A NAME=446><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZSCAN>CALL RZSCAN (CHPATH,UROUT)</A><P>
<DL COMPACT>
<DT>CHPATH
<DD>Character variable specifying the directory pathname
from which the scan should start.
<DT>UROUT
<DD>Variable containing the address of the user
routine to be called by <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZSCAN>RZSCAN</A> for each directory.
This variable must be declared EXTERNAL in the routine
which calls <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZSCAN>RZSCAN</A>.
</DL>Subroutine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZSCAN>RZSCAN</A> scans a directory structure from the specified
starting directory. For each subdirectory found, the user provided
routine <A HREF=#UROUT>UROUT</A> is called as shown below.
<b>Example of using the routine RZSCAN</b><PRE><TT>EXTERNAL UROUT

      CALL RZSCAN('//CERN/DELPHI',UROUT)

      END

      SUBROUTINE UROUT(CHPATH)
      CHARACTER*(*)    CHPATH
      PRINT *,CHPATH(1:LENOCC(CHPATH))
      END</TT></PRE>
<P>
<H2><A NAME=SECTION0011050000000000000>      Example 2: Using the geometry file of a LEP experiment</A></H2>
4cmList the contents of a directory
<A NAME=459><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZLDIR>CALL RZLDIR (CHPATH,CHOPT)</A><P>
<P>
<DL COMPACT>
<DT>CHPATH
<DD>Character variable specifying the directory pathname.
<DL COMPACT>
<DT>' '
<DD>List information for the <tt>CWD</tt> (default).
<DT>'T'
<DD>List also subdirectory tree from specified directory.
<DT>'//'
<DD>List all the RZ files.
</DL><DT>CHOPT
<DD>Character variable specifying the options
<DL COMPACT>
<DT>'A'
<DD>List all keys created with option <tt>'A'</tt> by <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOUT>RZOUT</A>
or <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZVOUT>RZVOUT</A>.
<DT>' '
<DD>By default such keys are not listed.
</DL></DL>The keys and the subdirectory names belonging to a given pathname can
be listed by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZLDIR>RZLDIR</A>.
<P>
If the keys have been defined by <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A> or <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>
with format <tt>'H'</tt>,
they are listed each with 4 characters. If keys have been defined
with format <tt>'A'</tt>, they are listed without separators.
<P>
<H2><A NAME=SECTION0011050000000000000>       Example 2: Using the geometry file of a LEP experiment</A></H2>
10cmRetrieve the contents of a directory
<A NAME=482><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZRDIR>CALL RZRDIR (MAXDIR,CHDIR*,NDIR*)</A><P>
<P><B>Input parameter description:</B><P><DL COMPACT>
<DT>MAXDIR
<DD>Length of the character array <tt>CHDIR</tt>
</DL><P><B>Output parameter description:</B><P><DL COMPACT>
<DT>CHDIR*
<DD>Character array which will contain the directory names attached to
the <tt>CWD</tt>. If the length of the directory name is greater then the length
of one element of <tt>CHDIR</tt> (as obtained by the <tt>LEN</tt> function), only
as many characters as will fit in the array element are returned, and
an error code will be set in <tt>IQUEST(1)</tt>.
<DT>NDIR*
<DD>Actual number of subdirectories attached to the <tt>CWD</tt><BR>If this number is greater than <tt>MAXDIR</tt>, only the first
<tt>MAXDIR</tt> directory names will be returned in <tt>CHDIR</tt>
(see <tt>IQUEST(11)</tt>)
<A NAME=1094><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
</DL>The list of <tt>NDIR</tt> directories attached to the <tt>CWD</tt> is 
retrieved and stored into the character array <tt>CHDIR</tt>.
<P>
<H3><A NAME=SECTION0011060000000000000> RZRDIR return codes</A></H3>
<P>
<A NAME=1095><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<DL COMPACT>
<DT>IQUEST(1)
<DD>Error status
<DL COMPACT>
<DT>0
<DD>Normal completion
<DT>1
<DD>More entries present in the directory than returned in <tt>CHDIR</tt>
(see <tt>NDIR</tt> and <tt>IQUEST(11)</tt>).
</DL><DT>IQUEST(11)
<DD>Actual number of subdirectories
</DL><H2><A NAME=SECTION0011060000000000000>  RZRDIR return codes</A></H2>
4cmSet the password of the current working directory
<P><A NAME=RZPASS>CALL RZPASS (CHPASS,CHOPT)</A><P>
<A NAME=522><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<DL COMPACT>
<DT>CHPASS
<DD>Character string specifying the password.
<DT>CHOPT
<DD>Character string specifying the options desired:
<DL COMPACT>
<DT>' '
<DD>Specify a password (default),
<DT>'S'
<DD>Set or change a password (to change a password a previous call to
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZPASS>RZPASS</A> specifying the old password must have been made).
</DL></DL>Each directory of an RZ file can have its own write password.
When an RZ file is first initialized with <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMAKE>RZMAKE</A> there is
no write password set.
Routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZPASS>RZPASS</A> can be used to specify
or change the password of the <tt>CWD</tt>.
<A NAME=533><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>By default, when a directory is created (<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>), the write
password is set equal to the one of the parent directory.
If a password is set, a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZPASS>RZPASS</A> is necessary to be able
to write a new key, create a new directory or delete a key or directory.
The password specified using <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZPASS>RZPASS</A> is
checked against the one encrypted in the RZ directory referenced.
<P>
<b>Examples:</b><P>
<PRE>



  CALL RZPASS('password',' ')    specifies a write password

  CALL RZPASS('Newpassword,'S')  changes or sets a password
</PRE><P>
<H1><A NAME=SECTION0011060000000000000>   RZRDIR return codes</A></H1>
16cmWrite a bank or data structure
<P><A NAME=RZOUT>CALL RZOUT (IXDIV,LSUP,KEY,*ICYCLE*,CHOPT)</A><P>
<A NAME=547><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><B>Input parameter description:</B><P><DL COMPACT>
  <DT>IXDIV
<DD>Index of the division(s)<BR>May be zero if the <tt>D</tt> option is not selected<BR>May be a compound index
    (see the description of the routine <A HREF=../../zebra/ZEBMZ1/chapter2_1.html#MZIXCO>MZIXCO</A> in the MZ reference
    manual).
    if the <tt>D</tt> option is selected
  <DT>LSUP
<DD>Supporting address
    of the data structure (may be zero if the <tt>D</tt> option is selected)
  <DT>KEY
<DD>Keyword vector of length <tt>NWKEY</tt> as specified by <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>.
  <DT>ICYCLE
<DD>Cycle number (<tt>A</tt> option only)
  <DT>CHOPT
<DD>Character variable specifying the selected options.
  <DL COMPACT>
    <DT>data structure
<DD>   
    <DL COMPACT>
      <DT>' '
<DD>The data structure supported by the bank at
        <tt>LSUP</tt> is written out (the next link is not followed)
        <A NAME=564><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>      <DT>'D'
<DD>Complete division(s)<BR>default: Dropped banks are squeezed out<BR>(slower but maybe more economic than <tt>DI</tt>)
      <DT>'DI'
<DD>Immediate dump of divisions with dropped banks included
      <DT>'L'
<DD>Write the data structure supported by the linear structure
        at <tt>LSUP</tt> (the next link is followed)
      <A NAME=568><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>      <DT>'S'
<DD>Single bank at <tt>LSUP</tt>
    </DL><DT>mode
<DD>  
    <DL COMPACT>
      <DT>' '
<DD>Keep banks available after output (default)
      <DT>'A'
<DD>Key will not be visible by <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZLDIR>RZLDIR</A>
      <DT>'N'
<DD>No links, i.e. linkless handling
      <DT>'R'
<DD>Replace existing object of identical size and keys
      <DT>'W'
<DD>Drop data structure or wipe division(s) after output
    </DL></DL></DL><P><B>Output parameter description:</B><P><DL COMPACT>
  <DT>ICYCLE
<DD>Cycle number associated to the key entered<BR><tt>ICYCLE=1</tt> if <tt>KEY</tt>
    was not already present in the directory,
    and one larger than the previous cycle associated to the key otherwise.
</DL>To write a bank, data structure or a complete division to an RZ file and enter the
associated key
into the current working directory, a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOUT>RZOUT</A> should be made.
If the key is not yet present in the directory, a cycle number of
one is returned, while in any other case the cycle number is the old
one present on the file increased by one.
<P>
<H2><A NAME=SECTION0011100000000000000> RZOUT return codes</A></H2>
<P>
<A NAME=1097><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<DL COMPACT>
<DT>IQUEST(1)
<DD>Error status
<DL COMPACT>
<DT>0
<DD>Normal completion
<DT>1
<DD>The directory quota is exhausted, no more space
- nothing has been written
</DL><DT>IQUEST(2)
<DD>Number of physical records written
<DT>IQUEST(3)
<DD>Record number of the first record written
<DT>IQUEST(4)
<DD>Offset of the information inside the first record
<DT>IQUEST(5)
<DD>Record number of the continuation record
<DT>IQUEST(6)
<DD>Cycle number of the data structure written
<DT>IQUEST(7)
<DD>Number of keys in the directory
<DT>IQUEST(8)
<DD><tt>NWKEY</tt>, the number of words per key
<DT>IQUEST(9)
<DD>Number of records still available in the current subdirectory
<DT> 
<DD>
<DT>IQUEST(11)
<DD><tt>NWBK</tt>, number of words of bank material
</DL>
<H1><A NAME=SECTION0011100000000000000>  RZOUT return codes</A></H1>
4cmOutput an array
<P><A NAME=RZVOUT>CALL RZVOUT (VECT,NOUT,KEY,*ICYCLE*,CHOPT)</A><P>
<A NAME=601><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<P><B>Input parameter description:</B><P><DL COMPACT>
<DT>VECT
<DD>Array to be output onto the RZ file<BR><tt>VECT</tt> should be dimensioned at least to <tt>NOUT</tt>
<DT>NOUT
<DD>number of words of array <tt>VECT</tt> to be output
<DT>KEY
<DD>Keyword vector of length <tt>NWKEY</tt> as specified by <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>.
<DT>ICYCLE
<DD>Cycle number (<tt>'A'</tt> option only)
<DT>CHOPT
<DD>Character variable specifying the selected options.
<DL COMPACT>
<DT>format
<DD>
<DL COMPACT>
<DT>' '
<DD>The array contains floating point data (default)
<DT>'A'
<DD>Key will not be visible by <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZLDIR>RZLDIR</A>
<DT>'B'
<DD>The array contains bitted data
<DT>'H'
<DD>The array contains Hollerith data
<DT>'I'
<DD>The array contains integer data
<DT>'R'
<DD>Replace existing object of identical size and keys
</DL></DL></DL><P><B>Output parameter description:</B><P><DL COMPACT>
<DT>ICYCLE
<DD>Cycle number associated to the key entered<BR><tt>ICYCLE=1</tt> if <tt>KEY</tt> was not already present in the directory,
and one larger than the previous cycle associated to the key otherwise.
</DL><P>The contents of a FORTRAN array can be written
into an RZ file and associated with a key in the <tt>CWD</tt>
by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZVOUT>RZVOUT</A>.
The convention for the cycle number is the same as for <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZOUT>RZOUT</A>.
<P>
<H1><A NAME=SECTION0011100000000000000>   RZOUT return codes</A></H1>
18cmRead a bank or data structure
<P><A NAME=RZIN>CALL RZIN (IXDIV,*LSUP*,JBIAS,KEY,ICYCLE,CHOPT)</A><P>
<A NAME=631><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<P><B>Input parameter description:</B><P><DL COMPACT>
<DT>IXDIV
<DD>Index of the division to receive the data structure<BR><tt>IXDIV = 0</tt> means division 2 of the primary store
<DT>*LSUP*
<DD>
<DT>JBIAS
<DD><tt>JBIAS &lt; 1:</tt> <tt>LSUP</tt> is the supporting bank
and <tt>JBIAS</tt> is the link bias specifying where the data structure 
has to be introduced into this bank, i.e. the data structure will 
be connected to <tt>LQ(LSUP+JBIAS)</tt>.<BR><tt>JBIAS = 1:</tt>
<tt>LSUP</tt> is the supporting link, i.e. the data structure
is connected to <tt>LSUP</tt> (top level data structure)<BR><tt>JBIAS = 2:</tt> Stand alone data structure, no connection.
<DT>KEY
<DD>Keyword vector of the information to be read (default)<BR>sequential number of the key vector in the directory if 'S' option
<DT>ICYCLE
<DD>Cycle number of the key to be read<BR><tt>ICYCLE &gt; 0</tt> highest cycle number means read the highest cycle<BR><tt>ICYCLE = 0</tt> means read the lowest cycle
<DT>CHOPT
<DD>Character variable specifying the options selected.
<DL COMPACT>
<DT>data structure
<DD>  
<DL COMPACT>
<DT>' '
<DD>Default - Same as 'D' below
<DT>'C'
<DD>Provide information about the cycle numbers associated 
with <tt>KEY</tt>.<BR>The total number of cycles and the cycle number identifiers
of the 19 highest cycles are returned in <tt>IQUEST(50)</tt> and
<tt>IQUEST(51..89)</tt> respectively. <BR>The data struture associated with <tt>KEY</tt> will not be read
in unless the option <tt>D</tt> is also specified.
<DT>'D'
<DD>Read the data structure with the <tt>(KEY,ICYCLE)</tt> pair specified.
<DT>'N'
<DD>Read the neighbouring
<A NAME=tex2html46 HREF=ZEBRZ2.foot.html#657><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/foot_motif.gif"></A>
keys (i.e. those preceding and following <tt>KEY</tt>).<BR>The first 9 elements of the key-vectors of the previous and next key are available
respectively as <tt>IQUEST(31..39)</tt> and <tt>IQUEST(41..49)</tt>, see below.
<DT>'R'
<DD>Read data into existing bank at <tt>LSUP, JBIAS</tt>. Note that the bank
must have the same size as the one stored in the file.
<DT>'S'
<DD>KEY(1) contains the sequential number of the key vector
in the current directory (No search required).
</DL></DL></DL><P><B>Output parameter description:</B><P><DL COMPACT>
<DT>*LSUP*
<DD>For <tt>JBIAS = 1</tt> or <tt>2, LSUP</tt> contains
the entry address to the data structure<BR>In any case <tt>IQUEST(11)</tt> returns the entry address
</DL>When one wants to read a bank, data structure or division from
a direct access file into memory one calls <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZIN>RZIN</A> or <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZINPA>RZINPA</A>.
The information identified by a given <tt>KEY</tt> and cycle in the <tt>CWD</tt> are
input. If the cycle specified is not present on the file, the information
associated with the highest cycle of the given key will be used.
<P>
<P><A NAME=RZINPA>CALL RZINPA (CHPATH,IXDIV,*LSUP*,JBIAS,KEY,ICYCLE*,CHOPT)</A><P>
<A NAME=677><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<DL COMPACT>
<DT>CHPATH
<DD> Character variable specifying the name of the
directory containing the objects to be retrieved.
<DT>others
<DD> Remaining arguments as for <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZIN>RZIN</A>.
</DL>When one wants to read information from a key associated to a directory
which is not the <tt>CWD</tt>, then a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZINPA>RZINPA</A> should be made.
This routine has a supplementary character type argument <tt>CHPATH</tt>, which
specifies the pathname
of the directory where the information has to read.
<P>
<H2><A NAME=SECTION0011200000000000000> RZIN and RZINPA return codes</A></H2>
<P>
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZIN>RZIN</A> and <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZINPA>RZINPA</A> return the status, 
either normal or error completion,
in the <tt>QUEST</tt> vector as follows:
<A NAME=1098><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><b>Normal read status returns are:</b>
<DL COMPACT>
<DT>IQUEST(1)
<DD>Operation status code
<DL COMPACT>
<DT>1
<DD>key/cycle pair not present in the <tt>CWD</tt>
<DT>0
<DD>normal completion
</DL><DT>IQUEST(2)
<DD>number of physical records read
<DT>IQUEST(3)
<DD>Record number of the first record read
<DT>IQUEST(4)
<DD>Offset of the start of the information in the first record.
<DT>IQUEST(5)
<DD>Record number of the continuation record (0 if not <tt>'A'</tt> option).
<DT>IQUEST(6)
<DD><tt>ICYCLE:</tt> cycle number of information returned.
<DT>IQUEST(7)
<DD>Number of keys in the directory
<DT>IQUEST(8)
<DD><tt>NWKEY</tt>, the number of words per key<BR>
<DT>IQUEST(11)
<DD><tt>LSUP</tt>, the entry address into the data structure<BR>zero means: empty data structure
<DT>IQUEST(12)
<DD><tt>NWBK</tt>, the number of words occupied
by the data structure in memory                <BR>zero means: empty data structure
<DT>IQUEST(14)
<DD>Time stamp of the information(compressed).
In order to get
the unpacked date and time (integers), one can use the RZ internal
routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZDATE>RZDATE</A> as follows
<A NAME=RZDATE><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<PRE><TT>CALL RZDATE(IQUEST(14),IDATE,ITIME,1)</TT></PRE>
<DT>IQUEST(20)
<DD>Key serial number in the directory
<DT>IQUEST(21..20+NWKEY) 
<DD><tt>KEY(1)...KEY(NWKEY)</tt> if <tt>'S'</tt> option given<BR>
<DT>IQUEST(30)
<DD><tt>NWKEY</tt> or zero if no previous key is present (<tt>'N'</tt> option)
<DT>IQUEST(31..39) 
<DD>The first 9 elements of the key vector for the element preceding <tt>KEY</tt>
(if <tt>IQUEST(30) &gt; 0</tt>) <BR>Only <tt>IQUEST(31..30+MIN(NWKEY,9))</tt> are significant<BR>
<DT>IQUEST(40)
<DD><tt>NWKEY</tt> or zero if no following key is present (<tt>'N'</tt> option)
<DT>IQUEST(41..49) 
<DD>The first 9 elements of the key vector
for the element following <tt>KEY</tt> (if <tt>IQUEST(40) &gt; 0</tt>) <BR>Only <tt>IQUEST(41..40+MIN(NWKEY,9))</tt> are significant <BR>
<DT>IQUEST(50)
<DD>Number of cycles present for <tt>KEY</tt>
(<tt>'C'</tt> option)
<DT>IQUEST(51..69) 
<DD>The cycle number identifiers associated with <tt>KEY</tt><BR>If <tt>IQUEST(50) 
<PRE>


<=
</PRE>19</tt> then only <tt>IQUEST(51..50+IQUEST(50)</tt>)
are meaningful<BR>If <tt>IQUEST(50) &gt;19</tt> then <tt>IQUEST(51..69)</tt> contain the 19
highest cycles for <tt>KEY</tt>
<DT>IQUEST(71..89) 
<DD>The time stamp
information corresponding to each of the
initialized cycle numbers in <tt>IQUEST(51..69)</tt>
</DL><P>If the pair <tt>(KEY,ICYCLE)</tt> is not present in the
<tt>CWD (IQUEST(1)=1)</tt>
and the <tt>'N'</tt> option is given, then <tt>IQUEST(30...)</tt> and <tt>IQUEST(40...)</tt>
will contain, respectively, the ``lowest'' and ``highest'' key vectors present.
<P>
<H1><A NAME=SECTION0011200000000000000>  RZIN and RZINPA return codes</A></H1>
4cmInput an array from an RZ file
<P><A NAME=RZVIN>CALL RZVIN (VECT*,NDIM,NFILE*,KEY,ICYCLE,CHOPT)</A><P>
<A NAME=737><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<P><B>Input parameter description:</B><P><DL COMPACT>
<DT>NDIM
<DD>Number of words available in array <tt>VECT</tt> (e.g. declared
dimension)
<DT>KEY
<DD>Keyword vector of the information to be read
<DT>ICYCLE
<DD>Cycle number of the key to be read<BR><tt>ICYCLE &gt; 0</tt> highest cycle number means read the highest cycle<BR><tt>ICYCLE = 0</tt> means read the lowest cycle
<DT>CHOPT
<DD>Character variable specifying the options selected(see <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZIN>RZIN</A>).
</DL><P><B>Output parameter description:</B><P><DL COMPACT>
<DT>VECT*
<DD>FORTRAN array to contain the information input<BR>The array <tt>VECT</tt> should be at least dimensioned to <tt>NDIM</tt> words
<DT>NFILE*
<DD>Actual length of the array on the file
</DL>The information associated with a (key,cycle) pair on an RZ file can
be read into an array by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZVIN>RZVIN</A>.
The same conventions used by <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZIN>RZIN</A> for <tt>KEY</tt> and 
<tt>CYCLE</tt> in the <tt>CWD</tt> are used.
<P>
<H2><A NAME=SECTION0011300000000000000> RZVIN return codes</A></H2>
<P>
<A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZVIN>RZVIN</A> returns the read status, either normal or error completion,
in <tt>QUEST</tt> in a way similar to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZIN>RZIN</A>.
<A NAME=1099><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<H1><A NAME=SECTION0011300000000000000>  RZVIN return codes</A></H1>
17cmOperations on keys and cycles
<P>
<H2><A NAME=SECTION0011300000000000000>   RZVIN return codes</A></H2>
4cmPurge old cycles
<A NAME=766><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=767><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<P><A NAME=RZPURG>CALL RZPURG (NKEEP)</A><P>
<P>
<DL COMPACT>
<DT>NKEEP
<DD>Number of cycles which must be kept for the given key<BR>If <tt>NKEEP &lt; 1</tt> then <tt>NKEEP</tt> is taken to be 1 and only the
highest cycle is kept
</DL>This command can be compared with 
the <tt>PURGE</tt> command on the VAX/VMS system.
All but the last <tt>NKEEP</tt> cycles of all
key are deleted from the <tt>CWD</tt> by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZPURG>RZPURG</A>.
<P>
<H3><A NAME=SECTION0011310000000000000> RZPURG return codes</A></H3>
<P>
<A NAME=1100><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<DL COMPACT>
<DT>IQUEST(9)
<DD>Number of records still available in the current subdirectory
<P><DT>IQUEST(11)
<DD>Maximum number of cycles purged
<DT>IQUEST(12)
<DD>Number of words freed
<DT>IQUEST(13)
<DD>Number of records freed
</DL><H2><A NAME=SECTION0011310000000000000>  RZPURG return codes</A></H2>
4cmDelete a subtree from the current working directory
<P><A NAME=RZDELT>CALL RZDELT (CHDIR)</A><P>
<P>
<DL COMPACT>
<DT>CHDIR
<DD>Character variable specifying the directory name of the subtree of
the CWD.
</DL>A subtree of the <tt>CWD</tt> can be deleted by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZDELT>RZDELT</A>
<P>
<H3><A NAME=SECTION0011320000000000000> RZDELT return codes</A></H3>
<P>
<A NAME=1101><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<DL COMPACT>
<DT>IQUEST(1)
<DD>Error status
<DL COMPACT>
<DT>0
<DD>Normal completion
<DT>1
<DD>Invalid directory subtree name
</DL></DL><A NAME=803><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<H2><A NAME=SECTION0011320000000000000>  RZDELT return codes</A></H2>
4cmDelete a key from the current working directory
<P><A NAME=RZDELK>CALL RZDELK (KEY,ICYCLE,CHOPT)</A><P>
<DL COMPACT>
<DT>KEY
<DD>Key array of dimension <tt>NWKEY</tt> (see <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>)
<DT>ICYCLE
<DD>Cycle number of the key to be deleted
<DL COMPACT>
<DT>&gt;0
<DD> highest cycle number means delete the highest cycle
<DT>=0
<DD> means delete the lowest cycle
<DT>=-1,-2,...
<DD> means delete the highest cycle <tt>-1, -2,...</tt>
</DL><DT>CHOPT
<DD>Character variable specifying the options selected.
<DL COMPACT>
<DT>' '
<DD>Delete the explicitly specified cycle <tt>ICYCLE</tt> only (default).<BR>If cycle <tt>ICYCLE</tt> does not exist, no action is taken.
<DT>'C'
<DD>Delete <b>all</b> cycles corresponding to key (<tt>ICYCLE</tt> not used)
<DT>'K'
<DD>Delete all keys in the <tt>CWD</tt> (<tt>ICYCLE</tt> and <tt>KEY</tt> not used)
<DT>'S'
<DD>Delete all cycles smaller than cycle <tt>ICYCLE</tt> for the given
key-vector
</DL></DL>When a key-cycle pair has to be deleted from the
<tt>CWD</tt> a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZDELK>RZDELK</A> must be made
<A NAME=830><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<H3><A NAME=SECTION0011330000000000000> RZDELK return codes</A></H3>
<P>
<A NAME=1102><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<DL COMPACT>
<DT>IQUEST(1)
<DD>Operation status code
<DL COMPACT>
<DT>1
<DD>No entry for key/cycle pair specified
<DT>0
<DD>normal completion
</DL><DT>IQUEST(11)
<DD>Maximum number of cycles deleted
<DT>IQUEST(12)
<DD>Number of words freed
<DT>IQUEST(13)
<DD>Number of records freed
</DL><b>Examples:</b><P>
<PRE>



  CALL RZDELK(KEY,2,' ')  deletes the in-
                          formation associated with key KEY and
                          cycle number 2 in the CWD.


  CALL RZDELK(KEY,4,'S')  deletes all information associated
                          with key KEY and a cycle number
                          smaller than 4 in the CWD.

  CALL RZDELK(0,0,'K')    deletes all cycles of all keys in the
                          CWD.
</PRE><P><H2><A NAME=SECTION0011330000000000000>  RZDELK return codes</A></H2>
4cmRename a key in the current working directory
<P><A NAME=RZRENK>CALL RZRENK (KEYOLD,KEYNEW)</A><P>
<P>
<DL COMPACT>
<DT>KEYOLD
<DD>Key array of dimension <tt>NWKEY</tt> containing the old key vector
<DT>KEYNEW
<DD>Key array of dimension <tt>NWKEY</tt> containing the new key vector
</DL>A key in the <tt>CWD</tt> can be renamed by a call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZRENK>RZRENK</A>
<P>
<H3><A NAME=SECTION0011340000000000000> Return codes</A></H3>
<P>
<A NAME=1104><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<DL COMPACT>
<DT>IQUEST(1)
<DD>Operation status code
<DL COMPACT>
<DT>1
<DD>No entry for <tt>KEYOLD</tt> in the <tt>CWD</tt>
<DT>0
<DD>normal completion
</DL></DL><A NAME=873><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<H2><A NAME=SECTION0011340000000000000>  Return codes</A></H2>
17cmRetrieve the keys associated to the current working directory
<P><A NAME=RZKEYS>CALL RZKEYS (MAXDIM,MAXKEY,KEYS*,NKEYS*)</A><P>
<P>
<P><B>Input parameter description:</B><P><DL COMPACT>
<DT>MAXDIM
<DD>The actual first dimension of output array <tt>KEYS</tt>.
It should in principle be at least equal to the number of key elements
<tt>NWKEY</tt> as declared to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>.
<DT>MAXKEY
<DD>The actual second dimension of output array <tt>KEYS</tt>.
</DL><P><B>Output parameter description:</B><P><DL COMPACT>
<DT>KEYS*
<DD>A 2-dimensional array dimensioned <tt>KEYS(MAXDIM,MAXKEY)</tt>.
It will contain the key vectors associated with the <tt>CWD</tt>.
Its first index runs over the key elements for a given key, while
its second index runs over the different keys.
<DT>NKEYS*
<DD>Number of keys returned in array <tt>KEYS</tt>.
</DL>Subroutine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZKEYS>RZKEYS</A> returns the list of keys created in the
<tt>CWD</tt>. The keys are returned in historical order.
<H3><A NAME=SECTION0011350000000000000> Return codes</A></H3>
<P>
<A NAME=1105><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<DL COMPACT>
<DT>IQUEST(1)
<DD>Error status
<DL COMPACT>
<DT>0
<DD>Normal completion
<DT>1
<DD>The keys have a length <tt>NWKEY &gt; MAXKEY</tt>
or more entries present in the directory than returned in <tt>KEYS</tt>
(see <tt>IQUEST(11)</tt>).
</DL><P><DT>IQUEST(11)
<DD>Actual number of keys in the <tt>CWD</tt>.
<DT>IQUEST(12)
<DD><tt>NWKEY</tt>, number of words characterizing a key vector
element for the <tt>CWD</tt> (as defined on Page <A HREF=chapter2_1.html#RZMDIR><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/cross_ref_motif.gif"></A> for <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZMDIR>RZMDIR</A>).
</DL><A NAME=910><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<H3><A NAME=SECTION0011360000000000000> Examples</A></H3>
<P>
For the lead glass blocks file in the example in
section 1, we could write:
<PRE><TT>INTEGER KEYS(5000)
 
      CALL RZKEYS(1,5000,KEYS,NKEYS)</TT></PRE>
For the events to be scanned we could have:
<PRE><TT>INTEGER KEYS(2,500)                      ! Up to 500 keys vectors
 
      CALL RZKEYS(2,500,KEYS,NKEYS)</TT></PRE>
<P>
<H1><A NAME=SECTION0011360000000000000>  Examples</A></H1>
17cmCopy a data structure from one directory to the <tt>CWD</tt>
<A NAME=915><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P><A NAME=RZCOPY>CALL RZCOPY (CHPATH,KEYIN,ICYCIN,KEYOUT,CHOPT)</A><P>
<P>
<DL COMPACT>
<DT>CHPATH
<DD>The pathname of the directory tree which has to be copied
to the <tt>CWD</tt>
<DT>KEYIN
<DD>Key-vector of the object to be copied from <tt>CHPATH</tt>.
<DT>ICYCIN
<DD>Cycle number of the key to be copied
<DT>KEYOUT
<DD>Key array of the object in the <tt>CWD</tt> after the copy
<DT>CHOPT
<DD>Character variable specifying the options selected.
<DL COMPACT>
<DT>' '
<DD>Copy the object from <tt>(KEYIN,ICYCIN)</tt> from
<tt>CHPATH</tt> to the <tt>CWD</tt> (default).<BR>If <tt>KEYOUT</tt> already exists, a new cycle is created.
<DT>'C'
<DD>Copy all cycles for the specified key (<tt>ICYCIN</tt> not used)
<DT>'K'
<DD>Copy all keys in the <tt>CWD</tt> (<tt>ICYCIN</tt> and <tt>KEYIN</tt> not used)
Given together with the 'C' option it copies all cycles of all keys.
<DT>'T'
<DD>Not yet implemented. Copy the complete tree <tt>CHPATH</tt>.
By default only the highest cycles are copied.
Given together with the 'C option all cycles are copied.
</DL></DL>Note that the input and output keys <tt>KEYIN</tt> and <tt>KEYOUT</tt> may be
identical. In this case, if <tt>KEYOUT</tt> already exists in the <tt>CWD</tt>, a new
cycle (or several) is created.
<P>
A directory tree identified by its
pathname <tt>CHPATH</tt> can be copied
to the <tt>CWD</tt> with the help of subroutine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZCOPY>RZCOPY</A>.
Routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZCOPY>RZCOPY</A> can also be used to merge two RZ files.
<P>
<H3><A NAME=SECTION0011370000000000000> Return codes</A></H3>
<P>
<A NAME=1107><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<DL COMPACT>
<DT>IQUEST(1)
<DD>Error status
<DL COMPACT>
<DT>1
<DD>Invalid pathname
<DT>0
<DD>Normal completion
</DL></DL>
<H1><A NAME=SECTION0011370000000000000>  Return codes</A></H1>
17cmCopy information from a directory from/to a sequential file
<P><A NAME=RZTOFZ>CALL RZTOFZ (LUNFZ,CHOPT)</A><P>
<P>
<DL COMPACT>
<DT>LUNFZ
<DD>Logical unit number of the FZ sequential access file
<DT>CHOPT
<DD>Character variable specifying the options selected.
<DL COMPACT>
<DT>' '
<DD>Write the highest cycle of the keys in the <tt>CWD</tt>
to the FZ file (default).
<DT>'C'
<DD>Write all cycles of the keys in the <tt>CWD</tt> to the FZ file
</DL></DL>In order to provide
easy transportability of data between different computer
systems information stored in an RZ directory tree can
be written to or read from a sequential file.
All keys in the tree associated with the <tt>CWD</tt> can be copied
to an FZ sequental file by using <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZTOFZ>RZTOFZ</A>.
The sequential file must be opened with <A HREF=../../zebra/ZEBFZ2/chapter2_1.html#FZFILE>FZFILE</A> prior to
the call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZTOFZ>RZTOFZ</A> and thus the transport mode (native or exchange)
is determined by the mode declared to <A HREF=../../zebra/ZEBFZ2/chapter2_1.html#FZFILE>FZFILE</A>.
<A NAME=971><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=972><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
The data structures are read into the system division of the
primary store before their transfer to the output file.
<A NAME=973><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=974><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=975><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=976><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<P><A NAME=RZFRFZ>CALL RZFRFZ (LUNFZ,CHOPT)</A><P>
<DL COMPACT>
<DT>LUNFZ
<DD>Logical unit number of the FZ sequential access file
<DT>CHOPT
<DD>Character variable specifying the options selected.
<DL COMPACT>
<DT>' '
<DD>Read all cycles of the keys present on the FZ file into the
<tt>CWD</tt> (default).
<DT>'H'
<DD>Read the highest cycle of the keys present on the FZ file into
the <tt>CWD</tt>.
</DL></DL>A directory tree can be read
from an FZ sequential file
into the <tt>CWD</tt> using the routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFRFZ>RZFRFZ</A>.
If a sub-directory with the same name as the one read in is already
present in the <tt>CWD</tt>, then a new cycle is created for the introduced keys.
The sequential file must be opened with <A HREF=../../zebra/ZEBFZ2/chapter2_1.html#FZFILE>FZFILE</A>
prior to the call to <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZFRFZ>RZFRFZ</A>
and hence the transport format (native or exchange)
is determined by the mode declared to <A HREF=../../zebra/ZEBFZ2/chapter2_1.html#FZFILE>FZFILE</A>.
<P>
<H1><A NAME=SECTION0011370000000000000>   Return codes</A></H1>
4cmRetrieve statistics about a given RZ directory
<P>
<P><A NAME=RZSTAT>CALL RZSTAT (CHPATH,NLEVELS,CHOPT)</A><P>
<P>
<DL COMPACT>
<DT>CHPATH
<DD>The pathname of the directory about which information
has to be provided.
<DT>NLEVELS
<DD>Number of levels below <tt>CHPATH</tt> about which space information
has to be accumulated.
<DT>CHOPT
<DD>Character variable specifying the options desired
<DL COMPACT>
<DT>' '
<DD>Print the statistics (default)
<DT>'Q'
<DD>Return the statistics in the user communication vector <tt>IQUEST</tt><BR></DL></DL>Routine <A HREF=../../zebra/ZEBRZ2/chapter2_1.html#RZSTAT>RZSTAT</A> provides information about the usage statistics
of an RZ direct access file associated with a given directory,
as specified by its pathname.
The routine can be used in two ways,
namely to print the global statistics at the end of a run, or
to retrieve, at any given moment, useful data about the space usage
(e.g. to verify whether there is
still enough space left to add another record).
<P>
If option <tt>'Q'</tt> is specified, the <tt>IQUEST</tt> vector contains on return:
<DL COMPACT>
<DT>IQUEST(11)
<DD> number of records used
<DT>IQUEST(12)
<DD> number of words   used
</DL><A NAME=1108><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<A NAME=1014><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<P>
<H1><A NAME=SECTION0012000000000000000> Overview of RZ calling Sequences</A></H1>
<P>
<P><A NAME=TRZCALL><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/invis_anchor.xbm"></A>
<PRE>
</PRE><P> <H2>References</H2>
<P><A NAME=BIBLIO HREF=../../general/biblio/bibliography.html>Global CERN library references</A><P>/user/goossens/cnasall/cnasbibl,/user/goossens/cnasall/textproc}    
<HR> <A NAME=tex2html86 HREF=tex2htmlindex2_2.html><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/next_motif.gif"></A> <A NAME=tex2html84 HREF=ZEBRZ2.html><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/up_motif.gif"></A> <A NAME=tex2html78 HREF=ZEBRZ2.html><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/previous_motif.gif"></A>  <A NAME=tex2html88 HREF=tex2htmlindex2_2.html><IMG ALIGN=MIDDLE SRC="http://asis01.cern.ch/CN/CERNTEX/icons/index_motif.gif"></A><BR>
<B> Next:</B> <A NAME=tex2html87 HREF=tex2htmlindex2_2.html>Index</A>
<B>Up:</B> <A NAME=tex2html85 HREF=ZEBRZ2.html>No Title</A>
<B> Previous:</B> <A NAME=tex2html79 HREF=ZEBRZ2.html>No Title</A>
<HR> <P>
<HR>

</BODY>
<P><ADDRESS>
goossens@cern.ch
</ADDRESS>