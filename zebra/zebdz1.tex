%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                 %
%   ZEBRA User Guide -- LaTeX Source                              %
%                                                                 %
%   Chapter DZ (Debugging tools)                                  %
%                                                                 %
%   The following external EPS files are referenced:              %
%   none                                                          %
%                                                                 %
%   Editor: Michel Goossens / CN-AS                               %
%   Last Mod.:  5 Aug 1993 10.35 mg                               %
%                                                                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Filename{H1DZ-The-debug-and-dump-package}
\chapter{DZ: The debug and dump package}
\label{sec:dzdescription}

\Filename{H2DZ-Display-routines}
\section{Display routines}

\subsection{Display of a bank or a data structure}

\Shubr{DZSHOW}{(CHTEXT,IXSTOR,LBANK,CHOPT,ILNK1,ILNK2,IDAT1,IDAT2)}
\Action
\Rind{DZSHOW} displays the contents of a bank or a data structure in a
store. The output format of the data part is controlled by the internal
or external I/O characteristic.
\index{display!data structure}
\index{display!bank}
\index{bank!display}
\index{data structure!display}
\begin{DLtt}{123456}
\item[CHTEXT]Character variable specifying the text to be printed
together with the display (truncated to 50 characters).
\item[IXSTOR]Index of the store containing the bank or data structure.
\item[LBANK]Address of bank or entry address to the data structure
which is to be displayed.
\item[CHOPT]Character variable specifying option desired.
\begin{DLtt}{123}
\item['B']Print the single bank at \Rarg{LBANK} (default).
\item['D']Print the bank contents from top to bottom Downwards
with five elements per line.
\item['S']Print the bank contents from left to right Sideways
with up to ten elements per line (default).
\item['L']Print the linear structure supported by \Rarg{LBANK}.
\item['V']Print the vertical (down) structure supported by \Rarg{LBANK}.
\item['Z']Print the data part of each bank in hexadecimal format
(i.e. ignoring the I/O characteristic).
\index{bank!I/O characteristic}
\end{DLtt}
\item[ILNK1]Index of the first link in a bank which will be printed.
\item[ILNK2]Index of the last link in a bank which will be printed.
\item[IDAT1]Index of the first data word in a bank which will be printed.
\item[IDAT2]Index of the last data word in a bank which will be printed.
\end{DLtt}
\begin{XMPt}{Example of the use of \Rind{DZSHOW}}
      CALL DZSHOW ('Display banks',IXSTOR,LQMAIN,'BLV',3,7,0,0)
\end{XMPt}
The complete 
\index{link!next}
\index{link!down}
structure supported by the bank
at address \Lit{LQMAIN} in  store \Lit{IXSTOR} is to
be displayed, i.e. both down and next links are to be followed.
\index{link!next}
\index{link!down}
Links 3 to 7 and all data words of each bank are to be printed.
\subsection*{Notes:}
\par
\begin{enumerate}
\item When \Lit{ILNK2<ILNK1} (\Lit{IDAT2<IDAT1}) no links (data) are output.
\item When \Lit{ILNK2=ILNK1=0} (\Lit{IDAT2=IDAT1=0}) all links (data) are
output.
\item When \Lit{ILNKi} or \Lit{IDATi} are outside bounds for a given bank, the
actual values for the bank in question are taken.
\item The explanation of the
first output line printed for each bank is given in section ``Bank information''
under the heading ``First line (General information)'' in the
description of routine \Rind{DZSNAP}.
\end{enumerate}
\begin{landscapebody}
\mbox{}\vspace*{1cm}
\begin{XMPt}{Example of (part of) output generated by \Rind{DZSHOW} (\Ropt{D} Down option)}
DZSHOW --- Dump EV structure                                                                       OPTIONS : BDLV                
                                                                                                                                 
DZSHOW  +++++ LEVEL     0 ++++++++++            Store  MainStor at absolute address 40019F30      ++++++++++                     
\index{link!down}
                                                                                                                                 
 EV  .     1     9069(QDIV2   ) SY/US/IO    1/    0/2153 NL/NS/ND    7/    7/      10 N/U/O/@O       0/       0/       1/    9069
STRUCTURAL links                                          --------------------                                                   
          1    VX        8883     3                 0     5                 0     7                 0                            
          2                 0     4                 0     6                 0                                                    
DATA part of bank                                         --------------------                                                   
DATA      1     "        Cern     3     "        McKi     5            123456     7     9945.0000         9     91200.000        
          2     "        Mars     4                 5     6                 3     8     8678.0000        10     1300.0000        
                                                                                                                                 
DZSHOW  +++++ LEVEL     1 ++++++++++            Store  MainStor at absolute address 40019F30      ++++++++++                     
                                                                                                                                 
 VX  .     1     9039(QDIV2   ) SY/US/IO    0/    0/ 1A3 NL/NS/ND    1/    1/      12 N/U/O/@O       0/    9069/    8950/    9039
STRUCTURAL links                                          --------------------                                                   
          1    TK        8972                                                                                                    
DATA part of bank                                         --------------------                                                   
DATA      1               100     4     1.0000000         7     10.060000        10     7.8410001                                
          2                 1     5     .28880000         8     .99849999        11     .27950001                                
          3                 2     6     29.850000         9     .00000000E+00    12     1.1560000                                
                                                                                                                                 
DZSHOW  +++++ LEVEL     2 ++++++++++            Store  MainStor at absolute address 40019F30      ++++++++++                     
                                                                                                                                 
 TK  .     1     9016(QDIV2   ) SY/US/IO    0/    0/   3 NL/NS/ND    0/    0/      12 N/U/O/@O       0/    9039/    8994/    9016
DATA part of bank                                         --------------------                                                   
DATA      1    -1.5230000         4    -1.0000000         7     .62870003E-01    10     1.5380000                                
          2    -2.2420001         5     .24080000E-03     8     2.3699999        11     1.1650000                                
          3     6.4229999         6     4.1160002         9    -.41209999        12     .31590000E-09                            
\end{XMPt}
\newpage
\mbox{}\vspace*{1cm}
\begin{XMPt}{Example of (part of) output generated by \Rind{DZSHOW} (\Ropt{S} Side option)}
DZSHOW  +++++ LEVEL     0 ++++++++++            Store  MainStor at absolute address 40019F30      ++++++++++                     
\index{link!down}
 EV  .     1     9069(QDIV2   ) SY/US/IO    1/    0/2153 NL/NS/ND    7/    7/      10 N/U/O/@O       0/       0/       1/    9069
--------  LINK part of bank  --------                                                                                            
      1 /        8883           0           0           0           0           0           0                                    
--------  DATA part of bank  --------                                                                                            
      1 /       "Cern       "Mars       "McKi           5      123456           3   9945.       8678.       .9120E+05   1300.    
DZSHOW  +++++ LEVEL     1 ++++++++++            Store  MainStor at absolute address 40019F30      ++++++++++                     
                                                                                                                                 
 VX  .     1     9039(QDIV2   ) SY/US/IO    0/    0/ 1A3 NL/NS/ND    1/    1/      12 N/U/O/@O       0/    9069/    8950/    9039
--------  LINK part of bank  --------                                                                                            
      1 /        8972                                                                                                            
--------  DATA part of bank  --------                                                                                            
      1 /         100           1           2   1.000       .2888       29.85       10.06       .9985       .0000E+00   7.841    
     11 /   .2795       1.156                                                                                                    
                                                                                                                                 
DZSHOW  +++++ LEVEL     2 ++++++++++            Store  MainStor at absolute address 40019F30      ++++++++++                     
                                                                                                                                 
 TK  .     1     9016(QDIV2   ) SY/US/IO    0/    0/   3 NL/NS/ND    0/    0/      12 N/U/O/@O       0/    9039/    8994/    9016
--------  DATA part of bank  --------                                                                                            
      1 /  -1.523      -2.242       6.423      -1.000       .2408E-03   4.116       .6287E-01   2.370      -.4121       1.538    
     11 /   1.165       .3159E-09                                                                                                
\end{XMPt}
\end{landscapebody}
\subsection{Print the format of a bank}
\Shubr{DZFORM}{(IXSTOR,LBANK)}
\Action
\Rind{DZFORM} prints the format of the data part of a bank.
It uses the I/O characteristic stored in the bank, decodes the
information and prints it in a format which is compatible with the
input of \Rind{MZFORM}.
\index{bank!format display}
\index{display!bank!format}

\begin{DLtt}{123456}
\item[IXSTOR]Index of the store where the bank resides.
\item[LBANK]Print the I/O characteristic for the bank at address \Rarg{LBANK}.
\newline If \Lit{LBANK = 0} all I/O characteristics declared with
\Rind{MZFORM} are printed
\end{DLtt}
\subsection{Display of a ZEBRA store}

\Shubr{DZSTOR}{(CHTEXT,IXSTOR)}

\Action
\Rind{DZSTOR} displays the structure of the ZEBRA store identified by
\Rarg{IXSTOR}.
The routine outputs the parameters characterizing the store, followed by a
list of all divisions and all link areas associated with the store in
question.
\index{store!display}
\index{display!store}

\begin{DLtt}{123456}
\item[CHTEXT]Character variable specifying the text to be printed
together with the dump (truncated to 50 characters).
\item[IXSTOR]Index of store to be displayed.
\end{DLtt}

The store parameters give the store sequence number (identifier),
name and
absolute address, followed by the useful length, the number of fence,
structural, permanent and working space link words, the minimal and
actual number of words in the reserve area between divisions 1 and 2,
the minimal offset of the upper end of default division 2 and the
number of short term and long term user divisions.


\begin{landscapebody}
\mbox{}\vspace*{1cm}
\begin{XMPt}{Example of the use of \Rind{DZSTOR}}
DZSTOR --- Dump of store //                                                                                                      
                                                                                                                                 
 --- Store Parameters ---                                                                                                        
Id    Name    Abs.addr.  Length   Fence      NS      NL      WS  Min.Resv.  Act.Resv.   Min(1+2)   Low  High                     
 0  MainStor  40019F30     9998       2       1       0       0        164       8542       2000     2     0                     
                                                                                                                                 
 --- Division parameters ---                                                                                                     
                                                                                                                                 
   DIVISION    START    END       MAX    KIND   MODE  WIPES  GARB.  GARB. PUSHES      LIVE BANKS  DROPPED BANKS    BANKS TOTAL   
 NB.   NAME   ADDRESS ADDRESS  LENGTH                        SYST.   FREE         NUMB.   LENGTH NUMB.   LENGTH NUMB.   LENGTH   
==============================================================================================================================   
  1  QDIV1          2       1       0 U/EVENT  FORWD      0      0      0      0       0        0     0        0     0        0  
  2  QDIV2       8544    9087     251 U/EVENT  REVRS      0      0      0      0      11      251     1      293    12      544  
 20  system      9159    9998     573  SYSTEM  REVRS      0      0      0      0       9      840     0        0     9      840  
                                                                                                                                 
 --- Link area parameters ---                                                                                                    
                                                                                                                                 
qwsp     PERMANENT LIST AREA      is at absolute 40019F30 NL/NS     1    1     status   ACTIVE                                   
system   PERMANENT LIST AREA      is at absolute 400AC6B8 NL/NS    20   10     status   ACTIVE                                   
/MYLINK/ PERMANENT LIST AREA      is at absolute 40095268 NL/NS   110    0     status   ACTIVE                                   
RZCL     PERMANENT LIST AREA      is at absolute 40031798 NL/NS    11    0     status   ACTIVE                                   
/DSDLK1/ TEMPORARY LIST AREA      is at absolute 40095430 NL/NS     2    0     status INACTIVE                                   
\end{XMPt}
\end{landscapebody}

\newpage
\subsection{Display of a link area}

\Shubr{DZAREA}{(CHTEXT,IXSTOR,CHLA,LLA,CHOPT)}

\Action \Rind{DZAREA} displays the contents of a ZEBRA link area.
\index{link!area!display}
\index{display!link area}

\begin{DLtt}{123456}
\item[CHTEXT]Character variable with text to be printed with the
dump (truncated to 50 characters).
\item[IXSTOR]Index of store to which link area is associated.
\item[CHLA]Character variable specifying the name of the link area to be mapped.
\newline If \Lit{CHLA=' '} all link areas associated with the store are printed
('N' option only)
\item[LLA]One of the links of the link area to be printed ('A' option only)
\item[CHOPT]Character variable specifying option desired
\begin{DLtt}{123}
\item['A']Use the link parameter \Rarg{LLA} to identify the link area (default)
\item['N']Use the name parameter \Rarg{CHLA} to identify the link area
\end{DLtt}
\end{DLtt}

\begin{XMPt}{Example of use of \Rind{DZAREA}}
      CALL DZAREA ('Display of link area TRACK',IXCOMM,'TRACK',0,'N')
\end{XMPt}
A list of the addresses in the link area \Lit{TRACK} associated
with store \Lit{IXCOMM} will be given.

\subsection{Survey of a ZEBRA data structure}

\Shubr{DZSURV}{(CHTEXT,IXSTOR,LBANK)}

\Action
\Rind{DZSURV} displays the survey of a ZEBRA data structure.
All horizontal (NEXT) as well as all vertical (DOWN) structural
\index{link!next}
links of a ZEBRA (sub)structure are followed.
Illegal structural links cause transfer to \Rind{ZFATAL}.
\index{data structure!survey}

\begin{DLtt}{123456}
\item[CHTEXT]Character variable specifying the text to be printed
together with the dump (truncated to 50 characters).
\item[IXSTOR]Index of store where the data structure resides.
\item[LBANK]Address of the bank supporting the data (sub)structure for which
the survey is desired.
\end{DLtt}
If the structure is legal, printed output is produced.
Each line contains the following information:
\begin{UL}
\item The cumulative number of words occupied by all banks so far
\item The total number of words occupied by all banks at this level
\item The length of the longest bank at this level
\item The number of banks at this level (any identifier)
\item Structural relation
\item Bank identifier(s)
\end{UL}

\newpage
\begin{XMPt}{Example of the use of \Rind{DZSURV}}
      CALL DZSURV ('Summary of the EV data structure',IXSTOR,LEV)
\end{XMPt}
\begin{XMPt}{Output generated by \Rind{DZSURV}}
DZSURV --- Survey of the EV data structure  ST= MainStor  LSTART=     9069
                                                                                                                                 
  NWCUM     NW   WBK  NBK    IDENTIFIER(S)                                                                                       
                                                                                                                                 
     27     27    27    1     EV                                                                                                 
     96     69    23    3       -1 VX                                                                                            
    250    154    22    7            -1 TK                                                                                       

DZSURV --- Structure supported by bank EV at 9069 in store MainStor occupies 250 words in 11 banks        
\end{XMPt}

In the output above the headings have the following meaning:
\begin{DLtt}{123456789}
\item[NWCUM]Cumulated \Lit{NW} to allow easy calculation of
the memory occupancy of the sub-structures
\item[NW]Total number of words occupied by these \Lit{NBK} banks,
including system words.
\item[WBK]Words per bank (if the \Lit{NBK} banks are not all
of the same length, the longest is given).
\item[NBK]Number of banks on this level
\item[IDENTIFIER]Name(s) of the banks at this level
\newline Several names are given if all names
in a linear structure are not identical
\end{DLtt}

In this example
the supporting bank \Lit{LEV} is in common \Lit{//} at address
\Lit{9580} pointed to by the link \Lit{LEV}.
It supports a linear structure of 3 \Lit{VX} banks via link \Lit{-7}.
The \Lit{VX} banks all
have a length of \Lit{23} words, and thus occupy \Lit{69} words of storage.
Each \Lit{VX} bank supports a linear chain of
\Lit{TK} banks via link \Lit{-1}.
There are \Lit{7} \Lit{TK} banks in memory, all of \Lit{25} words
(i.e. they occupy \Lit{25x7=175} words).
The total structure contains 11 banks and occupies \Lit{271} words.

\newpage

\Filename{H2DZ-Map-and-checks}
\section{Map and checks on the division level}
\subsection{Snap of one or more divisions}
\label{sec:DZSNAP}

\Shubr{DZSNAP}{(CHTEXT,IXDIV,CHOPT)}

\Action
\Rind{DZSNAP} provides a snapshot of one or more divisions in a ZEBRA
store. The kind of information provided is controlled by \Rarg{CHOPT}.
\index{division!snap}

\begin{DLtt}{123456}
\item[CHTEXT] Character variable specifying the title to be printed
      (truncated to 50 characters).
\item[IXDIV]  Index of the division(s) to be snapped.
      With function \Rind{MZIXCO} several divisions can be combined.
      If no explicit division identifiers are specified
      all user divisions are snapped.
\item[CHOPT]Character variable specifying the snap options desired.
\begin{DLttc}{123456789012}
\item['C' ritical]Dump any active bank with status bit \Lit{IQCRIT} set;
bit \Lit{IQCRIT} will be reset to zero in each bank
(option \Ropt{C} is implied by option \Ropt{T})
\item['D' ump]Dump any active bank with status bit \Lit{IQMARK} set;
bit \Lit{IQMARK} will be reset to zero in each bank
\item['E' xtend]Extend map entry to dump all links of each bank
(otherwise only as many links as will fit on a line)
\item['F' ull]Dump all active banks, links and data
\item['K' ill]Dropped banks are to be treated as active
(dropped banks are normally not dum\-ped with the \Ropt{D} or \Ropt{F} options)
\item['L' ink]Dump all link areas associated with the store
\item['M' ap]Print map entry for each bank
\item['T' erminal]Terminal type dump, used for the post-mortem dump
mainly to mark ``critical'' directly accessible banks
\item['W' ork]Dump the working space, links and data
\item['Z']Dump the information in hexadecimal.
\end{DLttc}
\end{DLtt}

\subsubsection{Store information}

The first part of the output of \Rind{DZSNAP} refers to the store,
and contains the following information:
\begin{DLttc}{1234567890}
\item[NAME]Name of the store
\item[lQSTOR]Absolute address \Lit{-1} of the store
\item[NQSTRU]Number of structural links at the beginning of the store
\item[NQREF]Number of permanent links at the beginning of the store
\item[NQLINK]Number of permanent + working space links
\item[NQMINR]Minimum size of the reserve area between divisions 1 and 2
\item[LQ2END]Lower limit for the upper and of division 2
\item[JQDVLL]Index of the most recent short-range divisions
\item[JQDVSY]Index of the system division
\item[NQFEND]Number of fence words
\item[LOW-1/N]Start and end address of division 1
\item[HIGH-1/N]Start and end address of division 2
\item[SYST-1/N]Start and end address of the system division
\item[END]Address of the last user word in the store
\end{DLttc}

\subsubsection{Bank information}

A map output in \Rind{DZSNAP} (selected by the option letter \Ropt{M})
\index{division!bank map}
gives a comprehensive overview of all banks in
the one or more divisions in a ZEBRA dynamic store.
One or two (MAP-)line(s) are printed per bank.
They contain the following information:

\subsubsection*{First line (General information)}

\begin{OLc}
\item The 4 character Hollerith bank identifier preceded by a \Lit{(}
if the bank has been dropped.
\item The bank numeric identifier
\item The address of the bank (status word) relative to the beginning of
the store and as an absolute address (in octal or hexadecimal)
\item The contents of the system and user part of the status word of the
of the bank (bits \Lit{19-32} and \Lit{1-18}) and of its I/O characteristic.
\item Number of links (\Lit{NL})/ of structural links
(\Lit{NS})/ of data words (\Lit{ND})
\item The contents of the next (\Lit{N})/up (\Lit{U})/and origin (\Lit{O})
\index{link!next}
links of the bank,
as well as of the contents of the address pointed to by the origin link
\index{link!origin}
(\Lit{@O}), which should contain
the address of the bank itself (hence allowing an easy cross-check).
When an inconsistency is detected the
faulty address is preceded by a minus sign (\Lit{-}).
\end{OLc}
\subsubsection*{Second line (Links) (present only when there are non-zero links)}
\begin{OL}
\item a two character flag:
\begin{DLttc}{12}
\item[**]the bank is dropped (also signaled by a left parenthesis '('
on the first line)
\item[.]the bank is active, all non-zero links are printed
\item[+]the bank is active, not all non-zero links are printed
\item[F]in position 2 flags a bank with potentially dangerous
contents in the links printed. This could be either:
\begin{ULc}
\item illegal link content
\item dropped bank supporting an active bank (not via \Lit{NX} link)
\item active bank pointing to a dropped bank
\end{ULc}
\end{DLttc}
\item links \Lit{1,2....N} are printed in this order with \Lit{N} the smaller of the
the following 2 numbers:
\begin{DLttc}{12}
\item[N1] the last non-zero link of this bank;
\item[N2] the number of links which can be printed on one line
(typically 9)
\end{DLttc}
If the link points to a correct bank-address, the \Lit{ID} of that
bank is also printed, preceded by \Lit{(} if this bank has been dropped.
If the link does not point to a status word, then a \Lit{-} or
\Lit{****} is printed against it for legal or illegal link content.
\end{OL}

Normally, the map is at the same time a printout of the more
interesting links in the banks.
However, banks may have more than the \Lit{N2} links, the maximum printed in the map.
If it is desired to print all the links,
the option letter \Ropt{E} should be given and
then an internal  call to \Rind{DZSHOW} is generated.

To avoid confusion about the format of a data word,
an extra symbol may be printed on its left:
\begin{DLttc}{12}
\item[O]for octal
\item[Z]for hexadecimal,
\item["]for BCD.
\end{DLttc}

\begin{landscapebody}
\mbox{}\vspace*{1cm}
\begin{XMPt}{Example of the output of \Rind{DZSNAP}}
DZSNAP --- Snap of //                                                                              OPTIONS : M                   
                                                                                                                                 
  NAME       LQSTOR NQSTRU  NQREF NQLINK LQMINR LQ2END JQDVLL JQDVSY NQFEND  LOW-1  LOW-N HIGH-1 HIGH-N SYST-1 SYST-N    END     
 MainStor(40019F30)      1      1      1    164   2001      2     20      2      2      1   8544   9087   9159   9998   9998     
                                                                                                                                 
DZSNAP.   -----  Store nb. 0 = MainStor Division nb. 2 = QDIV2                       --------------------                        
                                                                                                                                 
(TK  .******     8546(QDIV2   ) SY/US/IO   41/    0/2157 NL/NS/ND    0/    0/     282 N/U/O/@O       0/       0/       0/0       
 TK  .     2     8838(QDIV2   ) SY/US/IO    0/    0/   3 NL/NS/ND    0/    0/      12 N/U/O/@O    8860/    8883/    8882/    8838
 TK  .     1     8860(QDIV2   ) SY/US/IO    0/    0/   3 NL/NS/ND    0/    0/      12 N/U/O/@O       0/    8883/    8838/    8860
 VX  .     3     8883(QDIV2   ) SY/US/IO    0/    0/ 1A3 NL/NS/ND    1/    1/      12 N/U/O/@O    8950/    9069/    9068/    8883
     . LINKS      8838 TK                                                                                                        
 TK  .     2     8905(QDIV2   ) SY/US/IO    0/    0/   3 NL/NS/ND    0/    0/      12 N/U/O/@O    8927/    8950/    8949/    8905
 TK  .     1     8927(QDIV2   ) SY/US/IO    0/    0/   3 NL/NS/ND    0/    0/      12 N/U/O/@O       0/    8950/    8905/    8927
 VX  .     2     8950(QDIV2   ) SY/US/IO    0/    0/ 1A3 NL/NS/ND    1/    1/      12 N/U/O/@O    9039/    9069/    8883/    8950
     . LINKS      8905 TK                                                                                                        
 TK  .     3     8972(QDIV2   ) SY/US/IO    0/    0/   3 NL/NS/ND    0/    0/      12 N/U/O/@O    8994/    9039/    9038/    8972
 TK  .     2     8994(QDIV2   ) SY/US/IO    0/    0/   3 NL/NS/ND    0/    0/      12 N/U/O/@O    9016/    9039/    8972/    8994
 TK  .     1     9016(QDIV2   ) SY/US/IO    0/    0/   3 NL/NS/ND    0/    0/      12 N/U/O/@O       0/    9039/    8994/    9016
 VX  .     1     9039(QDIV2   ) SY/US/IO    0/    0/ 1A3 NL/NS/ND    1/    1/      12 N/U/O/@O       0/    9069/    8950/    9039
     . LINKS      8972 TK                                                                                                        
 EV  .     1     9069(QDIV2   ) SY/US/IO    1/    0/2153 NL/NS/ND    7/    7/      10 N/U/O/@O       0/       0/       1/    9069
     . LINKS      8883 VX                                                                                                        
\end{XMPt}
\end{landscapebody}

\subsection{Verify one or more ZEBRA divisions}


\Shubr{DZVERI}{(CHTEXT,IXDIV,CHOPT)}

\Action
\Rind{DZVERI} checks the structure of one or more divisions in a ZEBRA store. 
The verification detail depends on the settings in \Rarg{CHOPT}.
\index{division!verification}

\begin{DLtt}{123456}
\item[CHTEXT]Character variable specifying the text to be printed
together with the verification (truncated to 50 characters).\\
\Lit{CHTEXT=' '}: No message is output unless an error is detected.
In the latter case a message detailing the problem is
{\bf always} output, irrespective of \Rarg{CHTEXT}.
\item[IXDIV]Index of the division(s) to be verified.
\newline For a combination of divisions the MZ function \Rind{MZIXCO} should
be used.\\
If no explicit division identifiers are specified
all user divisions are verified.
\item[CHOPT]Character variable specifying level of checks desired.
\begin{DLtt}{123}
\item['C']Check chaining of banks only (default)
\item['F']Errors are considered fatal and generate a call to \Rind{ZFATAL}
\item['L']Check validity of the structural links in the banks
\index{link!structural}
(implies \Ropt{C})
\item['S']Check the store parameters
\item['U']Check the validity of the up and origin links in the banks
\index{link!up}
\index{link!origin}
(implies \Ropt{C})
\end{DLtt}
\end{DLtt}

When an error is detected the variable \Lit{\IQUEST(1)} in common \Lit{/\QUEST/}
will be non zero. When everything is correct it will contain zero.

\begin{XMPt}{Example of the use of \Rind{DZSTOR} to check store parameters}
     CALL DZVERI('Check store layout',IXSTOR,'S')
\end{XMPt}
The previous example only checks the store parameters for store \Lit{IXSTOR}.
\begin{XMPt}{Example of the use of \Rind{DZSTOR} to make a complete check}
     CALL DZVERI('Check everything',IXDIVI,'CFLSU')
\end{XMPt}
This example checks the store parameters of the store containing
the divisions \Lit{IXDIVI},
verifies the chaining of the banks and the correctness of all
links (structural, next, up and origin links). When an error is
\index{link!structural}
\index{link!up}
\index{link!origin}
\index{link!next}
detected an exit is forced via \Rind{ZFATAL}.

It should be noted that in the MZ package, developped by J.Zoll, a routine
\Rind{ZVERIF}, with a functionality similar to \Rind{DZVERI} is available. 
This routine has two somewhat different modes of operation:
one in which all data in and relevant to a complete
store are checked and a call to \Rind{ZFATAL} is generated if it finds trouble,
and a second one in which, in case of trouble, control is returned to the user,
who can find information about the error condition in the communication vector
\IQUEST.

\Rind{ZVERIF} is used by the automatic verification procedure
\Rind{ZVAUTO}, see the MZ Reference Guide for more details.

\newpage

\subsubsection*{DZVERI error return codes}
When \Rind{DZVERI} detects an error it fills the
\IQUEST{} vector as follows:
\begin{DLtt}{1234567890}
\item[IQUEST(11)]\Lit{JQSTOR}, the store identifier
\item[IQUEST(12)]\Lit{JQDIVI}, the division identifier
\par
\item[ -----  'C' {\rm option only -- For each faulty bank}]
\par
\item[IQUEST(13)]\Lit{LN}, its start address
\item[IQUEST(14)]\Lit{IQLS}, its status word
\item[IQUEST(15)]\Lit{IQNL}, its total number of links
\item[IQUEST(16)]\Lit{IQNS}, its number of structural links
\item[IQUEST(17)]\Lit{IQNS}, its number of data words
\par
\item[ ----- 'L' {\rm option only (check structural links in banks)}]
\par
\item[IQUEST(18)]\Lit{L}, the address of the link being verified
\item[IQUEST(19)]\Lit{LQ(L)}, its contents
\par
\item[ ----- 'U' {\rm option only (check origin and up links in banks)}]
\par
\item[IQUEST(20)]\Lit{LUP}, the value of the {\bf up} link
\item[IQUEST(21)]\Lit{LORIG}, the value of the {\bf origin} link
\end{DLtt}

\newpage

\Filename{H2DZ-Monitor-changes}
\section{Monitor changes inside a ZEBRA store or bank.}
\subsection{Calculate the checksum of a vector in a ZEBRA store}

\Shubr{DZCHVC}{(CHTEXT,IXSTOR,LBEGIN,LEND,CHOPT,*ISUM*)}

\Action
\Rind{DZCHVC} calculates the checksum of the vector (interval)
{\tt [LBEGIN,LEND]}
in a given ZEBRA store and returns the checksum result in a 2-word
user vector.
\index{checksum!store}

\Idesc

\begin{DLtt}{123456}
\item[CHTEXT]Character variable specifying the text to be printed
(truncated to 50 characters).
\item[IXSTOR]Index of the store where the checksum has to be calculated.
\item[LBEGIN]First word of the interval for which the checksum
has to be calculated
which is to be displayed.
\item[LEND]Last word of the interval for which the checksum
has to be calculated
\item[CHOPT]Character variable specifying option desired.
\begin{DLtt}{123}
\item['C']Calculate the checksum for the desired interval (default)
\item['V']Verify - Compare the newly calculated value of the checksum with the
one given on input in the array \Rarg{ISUM}
\end{DLtt}
\item[*ISUM*]\Ropt{V} option only -- Two word integer array containing the
checksum calculated by a previous call to \Rind{DZCHVC}. This value has to be
compared with the newly calculated checksum for the given interval.
\end{DLtt}
\Odesc
\begin{DLtt}{123456}
\item[*ISUM*]Two word integer array containing the calculated checksum.
\newline This vector can be used as input to a subsequent call to
\Rind{DZCHVC} for the same interval or can be tested for modifications by the
user himself.
\end{DLtt}

When the \Ropt{V} option is set and a difference is detected between the
input and output values of \Rarg{ISUM}, then a non-zero value will be
returned in \Lit{\IQUEST(1)}, otherwise \Lit{\IQUEST(1)} will be zero.

\subsubsection*{Important remark}

Since the checksum algorithm
sums the contents of the vector \Lit{[LBEGIN,LEND]}
bit by bit, not all possible changes can be detected (e.g. inversions
in the sequence of the elements will go undetected).

\newpage

\subsection{Monitor changes in a ZEBRA bank}

\Shubr{DZCHST}{(CHTEXT,IXSTOR,LBANK,CHOPT,*ISUM*)}

\Action
\Rind{DZCHST} monitors changes in the banks of ZEBRA data structure.
It uses routine \Rind{DZCHVC}.
The data, system and link part of the banks are monitored separately.
\index{checksum!bank}

\Idesc
\begin{DLtt}{123456}
\item[CHTEXT]Character variable specifying the text to be printed
(truncated to 20 characters).
\item[IXSTOR]Index of the store where the bank to be monitored resides.
\item[LBANK]Address of the bank to be monitored.
\item[CHOPT]Character variable specifying option desired.
\begin{DLtt}{123}
\item['B']Bank - Consider the checksum of the single bank at \Rarg{LBANK} (default)
\item['C']Calculate the checksum for the desired banks(s) (default)
 checksum for the desired bank parts
\item['D']Consider the checksum of the
structure supported by \Rarg{LBANK}, but do not follow the next link.
\index{link!next}
\item['L']Consider the checksum of the
structure supported by \Rarg{LBANK}, also following the next link.
\index{link!next}
\item['V']Verify - Compare the newly calculated value of the checksums with the
ones given on input in the array \Rarg{ISUM}.
\end{DLtt}
\item[*ISUM*]\Ropt{V} option only -- Six word integer array containing the
checksums calculated by a previous call to \Rind{DZCHST}. These values have to
be compared with the newly calculated checksums for the different
parts of the bank(s) in the data structure.
\end{DLtt}
\Odesc
\begin{DLtt}{123456}
\item[*ISUM*]Six word integer array containing the calculated
checksums for the different parts of the bank as follows:
\begin{DLtt}{123}
\item[1-2]Checksum of the {\bf data} part
\item[3-4]Checksum of the {\bf link} part
\item[5-6]Checksum of the {\bf system} part
\end{DLtt}
This array should be used as input to a subsequent call to \Rind{DZCHST}
for the same bank or can be tested for modifications by the
user himself.
\end{DLtt}

When the \Ropt{V}erify option is active and a difference is detected
then the variable \Lit{\IQUEST(1)} in common \Lit{/\QUEST/}
will be non zero. When everything is correct it will contain zero.

\subsubsection*{DZCHST Error return codes}

When \Rind{DZCHST} detects an error then it fills the \Lit{\IQUEST} vector as follows:
\begin{DLtt}{1234567890}
\item[IQUEST(11)]\Lit{0} : Data part OK. \Lit{1} : Data part faulty
\item[IQUEST(12)]\Lit{0} : Link part OK. \Lit{1} : Link part faulty
\item[IQUEST(13)]\Lit{0} : System part OK. \Lit{1} : System part faulty
\end{DLtt}
